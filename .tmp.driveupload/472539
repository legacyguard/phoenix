var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=Reflect.get,l=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),c=(t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,u=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&c(e,n,t[n]);if(s)for(var n of s(t))i.call(t,n)&&c(e,n,t[n]);return e},d=(e,s)=>t(e,n(s)),h=(e,t)=>{var n={};for(var r in e)o.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&s)for(var r of s(e))t.indexOf(r)<0&&i.call(e,r)&&(n[r]=e[r]);return n},f=(e,t,n)=>new Promise((s,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},i=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,i);a((n=n.apply(e,t)).next())}),p=function(e,t){this[0]=e,this[1]=t},m=(e,t,n)=>{var s=(e,t,r,o)=>{try{var i=n[e](t),a=(t=i.value)instanceof p,l=i.done;Promise.resolve(a?t[0]:t).then(n=>a?s("return"===e?e:"next",t[1]?{done:n.done,value:n.value}:n,r,o):r({value:n,done:l})).catch(e=>s("throw",e,r,o))}catch(c){o(c)}},r=e=>o[e]=t=>new Promise((n,r)=>s(e,t,n,r)),o={};return n=n.apply(e,t),o[l("asyncIterator")]=()=>o,r("next"),r("throw"),r("return"),o},y=e=>{var t,n=e[l("asyncIterator")],s=!1,r={};return null==n?(n=e[l("iterator")](),t=e=>r[e]=t=>n[e](t)):(n=n.call(e),t=e=>r[e]=t=>{if(s){if(s=!1,"throw"===e)throw t;return t}return s=!0,{done:!1,value:new p(new Promise(s=>{var r=n[e](t);r instanceof Object||(e=>{throw TypeError(e)})("Object expected"),s(r)}),1)}}),r[l("iterator")]=()=>r,t("next"),"throw"in n?t("throw"):r.throw=e=>{throw e},"return"in n&&t("return"),r},g=(e,t,n)=>(t=e[l("asyncIterator")])?t.call(e):(e=e[l("iterator")](),t={},(n=(n,s)=>(s=e[n])&&(t[n]=t=>new Promise((n,r,o)=>(t=s.call(e,t),o=t.done,Promise.resolve(t.value).then(e=>n({value:e,done:o}),r)))))("next"),n("return"),t),v={exports:{}};!function(){var e=function(e){var t,n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new E(s||[]);return r(i,"_invoke",{value:$(e,n,a)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",p="executing",m="completed",y={};function g(){}function v(){}function _(){}var b={};c(b,i,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(L([])));S&&S!==n&&s.call(S,i)&&(b=S);var x=_.prototype=g.prototype=Object.create(b);function O(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function A(e,t){function n(r,o,i,a){var l=d(e[r],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then(function(e){n("next",e,i,a)},function(e){n("throw",e,i,a)}):t.resolve(u).then(function(e){c.value=e,i(c)},function(e){return n("throw",e,i,a)})}a(l.arg)}var o;r(this,"_invoke",{value:function(e,s){function r(){return new t(function(t,r){n(e,s,t,r)})}return o=o?o.then(r,r):r()}})}function $(e,t,n){var s=h;return function(r,o){if(s===p)throw new Error("Generator is already running");if(s===m){if("throw"===r)throw o;return P()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var a=I(i,n);if(a){if(a===y)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===h)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=p;var l=d(e,t,n);if("normal"===l.type){if(s=n.done?m:f,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(s=m,n.method="throw",n.arg=l.arg)}}}function I(e,n){var s=n.method,r=e.iterator[s];if(r===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),y;var o=d(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function L(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(s.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return v.prototype=_,r(x,"constructor",{value:_,configurable:!0}),r(_,"constructor",{value:v,configurable:!0}),v.displayName=c(_,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,l,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},O(A.prototype),c(A.prototype,a,function(){return this}),e.AsyncIterator=A,e.async=function(t,n,s,r,o){void 0===o&&(o=Promise);var i=new A(u(t,n,s,r),o);return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},O(x),c(x,l,"Generator"),c(x,i,function(){return this}),c(x,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=L,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(s,r){return a.type="throw",a.arg=e,n.next=s,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=s.call(i,"catchLoc"),c=s.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var r=s.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:L(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),y}},e}(v.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}();var _=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const b=_;let w=0;var S=({id:e,action:t,payload:n={}})=>{let s=e;return void 0===s&&(s=b("Job",w),w+=1),{id:s,action:t,payload:n}},x={};let O=!1;x.logging=O,x.setLogging=e=>{O=e},x.log=(...e)=>O?void 0:null;const A=S,{log:$}=x,I=_;let R=0;const k="browser"===(e=>{const t={};return"undefined"!=typeof WorkerGlobalScope?t.type="webworker":"object"==typeof document?t.type="browser":"object"==typeof process&&(t.type="node"),void 0===e?t:t[e]})("type")?e=>new URL(e,window.location.href).href:e=>e;var E={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const L="6.0.1";var P=d(u({},{workerBlobURL:!0,logger:()=>{}}),{workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${L}/dist/worker.min.js`});const T=e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:e}}})=>{n(Error(`File could not be read! Code=${e}`))},s.readAsArrayBuffer(e)}),j=e=>f(void 0,null,function*(){let t=e;if(void 0===e)return"undefined";if("string"==typeof e)if(/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e))t=atob(e.split(",")[1]).split("").map(e=>e.charCodeAt(0));else{const n=yield fetch(e);t=yield n.arrayBuffer()}else if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)"IMG"===e.tagName&&(t=yield j(e.src)),"VIDEO"===e.tagName&&(t=yield j(e.poster)),"CANVAS"===e.tagName&&(yield new Promise(n=>{e.toBlob(e=>f(void 0,null,function*(){t=yield T(e),n()}))}));else if("undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas){const n=yield e.convertToBlob();t=yield T(n)}else(e instanceof File||e instanceof Blob)&&(t=yield T(e));return new Uint8Array(t)});var C={defaultOptions:P,spawnWorker:({workerPath:e,workerBlobURL:t})=>{let n;if(Blob&&URL&&t){const t=new Blob([`importScripts("${e}");`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(t))}else n=new Worker(e);return n},terminateWorker:e=>{e.terminate()},onMessage:(e,t)=>{e.onmessage=({data:e})=>{t(e)}},send:(e,t)=>f(void 0,null,function*(){e.postMessage(t)}),loadImage:j};const N=e=>{const t=u({},e);return["corePath","workerPath","langPath"].forEach(n=>{e[n]&&(t[n]=k(t[n]))}),t},M=S,{log:D}=x,B=_,q=E,{defaultOptions:W,spawnWorker:U,terminateWorker:F,onMessage:H,loadImage:X,send:K}=C;let J=0;var z=(...e)=>f(void 0,[...e],function*(e="eng",t=q.LSTM_ONLY,n={},s={}){const r=B("Worker",J),o=N(u(u({},W),n)),{logger:i,errorHandler:a}=o,l=h(o,["logger","errorHandler"]),c={},p="string"==typeof e?e.split("+"):e;let m=t,y=s;const g=[q.DEFAULT,q.LSTM_ONLY].includes(t)&&!l.legacyCore;let v,_;const b=new Promise((e,t)=>{_=e,v=t});let w=U(l);w.onerror=e=>{v(e.message)},J+=1;const S=({id:e,action:t,payload:n})=>new Promise((s,o)=>{D(`[${r}]: Start ${e}, action=${t}`);c[`${t}-${e}`]={resolve:s,reject:o},K(w,{workerId:r,jobId:e,action:t,payload:n})}),x=(e,t)=>S(M({id:t,action:"loadLanguage",payload:{langs:e,options:{langPath:l.langPath,dataPath:l.dataPath,cachePath:l.cachePath,cacheMethod:l.cacheMethod,gzip:l.gzip,lstmOnly:[q.DEFAULT,q.LSTM_ONLY].includes(m)&&!l.legacyLang}}})),O=(e,t,n,s)=>S(M({id:s,action:"initialize",payload:{langs:e,oem:t,config:n}}));H(w,({workerId:e,jobId:t,status:n,action:s,data:r})=>{const o=`${s}-${t}`;if("resolve"===n)D(`[${e}]: Complete ${t}`),c[o].resolve({jobId:t,data:r}),delete c[o];else if("reject"===n){if(c[o].reject(r),delete c[o],"load"===s&&v(r),!a)throw Error(r);a(r)}else"progress"===n&&i(d(u({},r),{userJobId:t}))});const A={id:r,worker:w,load:()=>{},writeText:(e,t,n)=>S(M({id:n,action:"FS",payload:{method:"writeFile",args:[e,t]}})),readText:(e,t)=>S(M({id:t,action:"FS",payload:{method:"readFile",args:[e,{encoding:"utf8"}]}})),removeFile:(e,t)=>S(M({id:t,action:"FS",payload:{method:"unlink",args:[e]}})),FS:(e,t,n)=>S(M({id:n,action:"FS",payload:{method:e,args:t}})),reinitialize:(e="eng",t,n,s)=>{if(g&&[q.TESSERACT_ONLY,q.TESSERACT_LSTM_COMBINED].includes(t))throw Error("Legacy model requested but code missing.");const r=t||m;m=r;const o=n||y;y=o;const i=("string"==typeof e?e.split("+"):e).filter(e=>!p.includes(e));return p.push(...i),i.length>0?x(i,s).then(()=>O(e,r,o,s)):O(e,r,o,s)},setParameters:(e={},t)=>S(M({id:t,action:"setParameters",payload:{params:e}})),recognize:(e,...t)=>f(void 0,[e,...t],function*(e,t={},n={text:!0},s){return S(M({id:s,action:"recognize",payload:{image:yield X(e),options:t,output:n}}))}),detect:(e,t)=>f(void 0,null,function*(){if(g)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return S(M({id:t,action:"detect",payload:{image:yield X(e)}}))}),terminate:()=>f(void 0,null,function*(){return null!==w&&(F(w),w=null),Promise.resolve()})};var $;return S(M({id:$,action:"load",payload:{options:{lstmOnly:g,corePath:l.corePath,logging:l.logging}}})).then(()=>x(e)).then(()=>O(e,t,s)).then(()=>_(A)).catch(()=>{}),b});const V=z;const G=()=>{const e=I("Scheduler",R),t={},n={};let s=[];R+=1;const r=()=>Object.keys(t).length,o=()=>{if(0!==s.length){const e=Object.keys(t);for(let r=0;r<e.length;r+=1)if(void 0===n[e[r]]){s[0](t[e[r]]);break}}};return{addWorker:n=>(t[n.id]=n,$(`[${e}]: Add ${n.id}`),$(`[${e}]: Number of workers=${r()}`),o(),n.id),addJob:(t,...i)=>f(void 0,null,function*(){if(0===r())throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return((t,r)=>new Promise((i,a)=>{const l=A({action:t,payload:r});s.push(e=>f(void 0,null,function*(){s.shift(),n[e.id]=l;try{i(yield e[t].apply(void 0,[...r,l.id]))}catch(c){a(c)}finally{delete n[e.id],o()}})),$(`[${e}]: Add ${l.id} to JobQueue`),$(`[${e}]: JobQueue length=${s.length}`),o()}))(t,i)}),terminate:()=>f(void 0,null,function*(){Object.keys(t).forEach(e=>f(void 0,null,function*(){yield t[e].terminate()})),s=[]}),getQueueLen:()=>s.length,getNumWorkers:r}},Y=z,Q={recognize:(e,t,n)=>f(void 0,null,function*(){const s=yield V(t,1,n);return s.recognize(e).finally(()=>f(void 0,null,function*(){yield s.terminate()}))}),detect:(e,t)=>f(void 0,null,function*(){const n=yield V("osd",0,t);return n.detect(e).finally(()=>f(void 0,null,function*(){yield n.terminate()}))})},Z={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},ee=E,te={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"},{setLogging:ne}=x;var se=u({languages:Z,OEM:ee,PSM:te,createScheduler:G,createWorker:Y,setLogging:ne},Q);function re(e,t,n,s,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}function oe(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)}let ie=function(){const{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return ie=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function ae(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const le=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(t){}try{return new Error(JSON.stringify(e))}catch(t){}}return new Error(e)};class ce extends Error{}class ue extends ce{constructor(e,t,n,s){super(`${ue.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.requestID=null==s?void 0:s.get("x-request-id"),this.error=t;const r=t;this.code=null==r?void 0:r.code,this.param=null==r?void 0:r.param,this.type=null==r?void 0:r.type}static makeMessage(e,t,n){const s=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new he({message:n,cause:le(t)});const r=null==t?void 0:t.error;return 400===e?new pe(e,r,n,s):401===e?new me(e,r,n,s):403===e?new ye(e,r,n,s):404===e?new ge(e,r,n,s):409===e?new ve(e,r,n,s):422===e?new _e(e,r,n,s):429===e?new be(e,r,n,s):e>=500?new we(e,r,n,s):new ue(e,r,n,s)}}class de extends ue{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class he extends ue{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class fe extends he{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class pe extends ue{}class me extends ue{}class ye extends ue{}class ge extends ue{}class ve extends ue{}class _e extends ue{}class be extends ue{}class we extends ue{}class Se extends ce{constructor(){super("Could not parse response content as the length limit was reached")}}class xe extends ce{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Oe extends Error{constructor(e){super(e)}}const Ae=/^[a-z][a-z0-9+.-]*:/i;let $e=e=>($e=Array.isArray,$e(e)),Ie=$e;function Re(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}const ke=e=>new Promise(t=>setTimeout(t,e)),Ee="5.11.0";const Le=()=>{var e,t,n,s,r;const o="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":Te(Deno.build.os),"X-Stainless-Arch":Pe(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!=(t=null==(e=Deno.version)?void 0:e.deno)?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":Te(null!=(n=globalThis.process.platform)?n:"unknown"),"X-Stainless-Arch":Pe(null!=(s=globalThis.process.arch)?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!=(r=globalThis.process.version)?r:"unknown"};const i=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return i?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${i.browser}`,"X-Stainless-Runtime-Version":i.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ee,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Pe=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Te=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let je;function Ce(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Ne(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Ce({start(){},pull(e){return f(this,null,function*(){const{done:n,value:s}=yield t.next();n?e.close():e.enqueue(s)})},cancel(){return f(this,null,function*(){var e;yield null==(e=t.return)?void 0:e.call(t)})}})}function Me(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{next(){return f(this,null,function*(){try{const e=yield t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}})},return(){return f(this,null,function*(){const e=t.cancel();return t.releaseLock(),yield e,{done:!0,value:void 0}})},[Symbol.asyncIterator](){return this}}}const De=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),Be="RFC3986",qe=e=>String(e),We={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:qe};let Ue=(e,t)=>{var n;return Ue=null!=(n=Object.hasOwn)?n:Function.prototype.call.bind(Object.prototype.hasOwnProperty),Ue(e,t)};const Fe=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),He=1024;function Xe(e,t){if($e(e)){const n=[];for(let s=0;s<e.length;s+=1)n.push(t(e[s]));return n}return t(e)}const Ke={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},Je=function(e,t){Array.prototype.push.apply(e,$e(t)?t:[t])};let ze;const Ve={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,s,r)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===n)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let a=0;a<o.length;a+=He){const e=o.length>=He?o.slice(a,a+He):o,t=[];for(let n=0;n<e.length;++n){let s=e.charCodeAt(n);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||"RFC1738"===r&&(40===s||41===s)?t[t.length]=e.charAt(n):s<128?t[t.length]=Fe[s]:s<2048?t[t.length]=Fe[192|s>>6]+Fe[128|63&s]:s<55296||s>=57344?t[t.length]=Fe[224|s>>12]+Fe[128|s>>6&63]+Fe[128|63&s]:(n+=1,s=65536+((1023&s)<<10|1023&e.charCodeAt(n)),t[t.length]=Fe[240|s>>18]+Fe[128|s>>12&63]+Fe[128|s>>6&63]+Fe[128|63&s])}i+=t.join("")}return i},encodeValuesOnly:!1,format:Be,formatter:qe,indices:!1,serializeDate:e=>(null!=ze?ze:ze=Function.prototype.call.bind(Date.prototype.toISOString))(e),skipNulls:!1,strictNullHandling:!1};const Ge={};function Ye(e,t,n,s,r,o,i,a,l,c,u,d,h,f,p,m,y,g){let v=e,_=g,b=0,w=!1;for(;void 0!==(_=_.get(Ge))&&!w;){const t=_.get(e);if(b+=1,void 0!==t){if(t===b)throw new RangeError("Cyclic object value");w=!0}void 0===_.get(Ge)&&(b=0)}if("function"==typeof c?v=c(t,v):v instanceof Date?v=null==h?void 0:h(v):"comma"===n&&$e(v)&&(v=Xe(v,function(e){return e instanceof Date?null==h?void 0:h(e):e})),null===v){if(o)return l&&!m?l(t,Ve.encoder,y,"key",f):t;v=""}if("string"==typeof(S=v)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(v)){if(l){const e=m?t:l(t,Ve.encoder,y,"key",f);return[(null==p?void 0:p(e))+"="+(null==p?void 0:p(l(v,Ve.encoder,y,"value",f)))]}return[(null==p?void 0:p(t))+"="+(null==p?void 0:p(String(v)))]}var S;const x=[];if(void 0===v)return x;let O;if("comma"===n&&$e(v))m&&l&&(v=Xe(v,l)),O=[{value:v.length>0?v.join(",")||null:void 0}];else if($e(c))O=c;else{const e=Object.keys(v);O=u?e.sort(u):e}const A=a?String(t).replace(/\./g,"%2E"):String(t),$=s&&$e(v)&&1===v.length?A+"[]":A;if(r&&$e(v)&&0===v.length)return $+"[]";for(let I=0;I<O.length;++I){const t=O[I],_="object"==typeof t&&void 0!==t.value?t.value:v[t];if(i&&null===_)continue;const w=d&&a?t.replace(/\./g,"%2E"):t,S=$e(v)?"function"==typeof n?n($,w):$:$+(d?"."+w:"["+w+"]");g.set(e,b);const A=new WeakMap;A.set(Ge,g),Je(x,Ye(_,S,n,s,r,o,i,a,"comma"===n&&m&&$e(v)?null:l,c,u,d,h,f,p,m,y,A))}return x}function Qe(e,t={}){let n=e;const s=function(e=Ve){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||Ve.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Be;if(void 0!==e.format){if(!Ue(We,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const s=We[n];let r,o=Ve.filter;if(("function"==typeof e.filter||$e(e.filter))&&(o=e.filter),r=e.arrayFormat&&e.arrayFormat in Ke?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":Ve.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||Ve.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:Ve.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:Ve.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:Ve.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?Ve.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:Ve.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:Ve.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:Ve.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:Ve.encodeValuesOnly,filter:o,format:n,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:Ve.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:Ve.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:Ve.strictNullHandling}}(t);let r,o;"function"==typeof s.filter?(o=s.filter,n=o("",n)):$e(s.filter)&&(o=s.filter,r=o);const i=[];if("object"!=typeof n||null===n)return"";const a=Ke[s.arrayFormat],l="comma"===a&&s.commaRoundTrip;r||(r=Object.keys(n)),s.sort&&r.sort(s.sort);const c=new WeakMap;for(let h=0;h<r.length;++h){const e=r[h];s.skipNulls&&null===n[e]||Je(i,Ye(n[e],e,a,l,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}const u=i.join(s.delimiter);let d=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}let Ze,et;function tt(e){let t;return(null!=Ze?Ze:(t=new globalThis.TextEncoder,Ze=t.encode.bind(t)))(e)}function nt(e){let t;return(null!=et?et:(t=new globalThis.TextDecoder,et=t.decode.bind(t)))(e)}var st,rt;class ot{constructor(){st.set(this,void 0),rt.set(this,void 0),re(this,st,new Uint8Array),re(this,rt,null)}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tt(e):e;re(this,st,function(e){let t=0;for(const r of e)t+=r.length;const n=new Uint8Array(t);let s=0;for(const r of e)n.set(r,s),s+=r.length;return n}([oe(this,st,"f"),t]));const n=[];let s;for(;null!=(s=it(oe(this,st,"f"),oe(this,rt,"f")));){if(s.carriage&&null==oe(this,rt,"f")){re(this,rt,s.index);continue}if(null!=oe(this,rt,"f")&&(s.index!==oe(this,rt,"f")+1||s.carriage)){n.push(nt(oe(this,st,"f").subarray(0,oe(this,rt,"f")-1))),re(this,st,oe(this,st,"f").subarray(oe(this,rt,"f"))),re(this,rt,null);continue}const e=null!==oe(this,rt,"f")?s.preceding-1:s.preceding,t=nt(oe(this,st,"f").subarray(0,e));n.push(t),re(this,st,oe(this,st,"f").subarray(s.index)),re(this,rt,null)}return n}flush(){return oe(this,st,"f").length?this.decode("\n"):[]}}function it(e,t){for(let n=null!=t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function at(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}st=new WeakMap,rt=new WeakMap,ot.NEWLINE_CHARS=new Set(["\n","\r"]),ot.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const lt={off:0,error:200,warn:300,info:400,debug:500},ct=(e,t,n)=>{var s,r;if(e)return s=lt,r=e,Object.prototype.hasOwnProperty.call(s,r)?e:void pt(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(lt))}`)};function ut(){}function dt(e,t,n){return!t||lt[e]>lt[n]?ut:t[e].bind(t)}const ht={error:ut,warn:ut,info:ut,debug:ut};let ft=new WeakMap;function pt(e){var t;const n=e.logger,s=null!=(t=e.logLevel)?t:"off";if(!n)return ht;const r=ft.get(n);if(r&&r[0]===s)return r[1];const o={error:dt("error",n,s),warn:dt("warn",n,s),info:dt("info",n,s),debug:dt("debug",n,s)};return ft.set(n,[s,o]),o}const mt=e=>(e.options&&(e.options=u({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var yt,gt,vt;class _t{constructor(e,t,n){this.iterator=e,yt.set(this,void 0),this.controller=t,re(this,yt,n)}static fromSSEResponse(e,t,n){let s=!1;const r=n?pt(n):console;return new _t(function(){return m(this,null,function*(){if(s)throw new ce("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{try{for(var o,i,a,l=g(function(e,t){return m(this,null,function*(){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ce("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ce("Attempted to iterate over a response with no body")}const n=new bt,s=new ot,r=Me(e.body);try{for(var o,i,a,l=g(function(e){return m(this,null,function*(){let t=new Uint8Array;try{for(var n,s,r,o=g(e);n=!(s=yield new p(o.next())).done;n=!1){const e=s.value;if(null==e)continue;const n=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tt(e):e;let r,o=new Uint8Array(t.length+n.length);for(o.set(t),o.set(n,t.length),t=o;-1!==(r=at(t));)yield t.slice(0,r),t=t.slice(r)}}catch(s){r=[s]}finally{try{n&&(s=o.return)&&(yield new p(s.call(o)))}finally{if(r)throw r[0]}}t.length>0&&(yield t)})}(r));o=!(i=yield new p(l.next())).done;o=!1){const e=i.value;for(const t of s.decode(e)){const e=n.decode(t);e&&(yield e)}}}catch(i){a=[i]}finally{try{o&&(i=l.return)&&(yield new p(i.call(l)))}finally{if(a)throw a[0]}}for(const e of s.flush()){const t=n.decode(e);t&&(yield t)}})}(e,t));o=!(i=yield new p(l.next())).done;o=!1){const t=i.value;if(!n)if(t.data.startsWith("[DONE]"))n=!0;else if(null!==t.event&&t.event.startsWith("thread.")){let e;try{e=JSON.parse(t.data)}catch(c){throw c}if("error"==t.event)throw new ue(void 0,e.error,e.message,void 0);yield{event:t.event,data:e}}else{let n;try{n=JSON.parse(t.data)}catch(c){throw r.error("Could not parse message into JSON:",t.data),r.error("From chunk:",t.raw),c}if(n&&n.error)throw new ue(void 0,n.error,void 0,e.headers);yield n}}}catch(i){a=[i]}finally{try{o&&(i=l.return)&&(yield new p(i.call(l)))}finally{if(a)throw a[0]}}n=!0}catch(c){if(ae(c))return;throw c}finally{n||t.abort()}})},t,n)}static fromReadableStream(e,t,n){let s=!1;return new _t(function(){return m(this,null,function*(){if(s)throw new ce("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{try{for(var r,o,i,a=g(function(){return m(this,null,function*(){const t=new ot,n=Me(e);try{for(var s,r,o,i=g(n);s=!(r=yield new p(i.next())).done;s=!1){const e=r.value;for(const n of t.decode(e))yield n}}catch(r){o=[r]}finally{try{s&&(r=i.return)&&(yield new p(r.call(i)))}finally{if(o)throw o[0]}}for(const e of t.flush())yield e})}());r=!(o=yield new p(a.next())).done;r=!1){const e=o.value;n||e&&(yield JSON.parse(e))}}catch(o){i=[o]}finally{try{r&&(o=a.return)&&(yield new p(o.call(a)))}finally{if(i)throw i[0]}}n=!0}catch(l){if(ae(l))return;throw l}finally{n||t.abort()}})},t,n)}[(yt=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=s=>({next:()=>{if(0===s.length){const s=n.next();e.push(s),t.push(s)}return s.shift()}});return[new _t(()=>s(e),this.controller,oe(this,yt,"f")),new _t(()=>s(t),this.controller,oe(this,yt,"f"))]}toReadableStream(){const e=this;let t;return Ce({start(){return f(this,null,function*(){t=e[Symbol.asyncIterator]()})},pull(e){return f(this,null,function*(){try{const{value:n,done:s}=yield t.next();if(s)return e.close();const r=tt(JSON.stringify(n)+"\n");e.enqueue(r)}catch(n){e.error(n)}})},cancel(){return f(this,null,function*(){var e;yield null==(e=t.return)?void 0:e.call(t)})}})}}class bt{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}function wt(e,t){return f(this,null,function*(){const{response:n,requestLogID:s,retryOfRequestLogID:r,startTime:o}=t,i=yield(()=>f(this,null,function*(){var s;if(t.options.stream)return pt(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):_t.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),o=null==(s=null==r?void 0:r.split(";")[0])?void 0:s.trim();if((null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))){return St(yield n.json(),n)}return yield n.text()}))();return pt(e).debug(`[${s}] response parsed`,mt({retryOfRequestLogID:r,url:n.url,status:n.status,body:i,durationMs:Date.now()-o})),i})}function St(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class xt extends Promise{constructor(e,t,n=wt){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,gt.set(this,void 0),re(this,gt,e)}_thenUnwrap(e){return new xt(oe(this,gt,"f"),this.responsePromise,(t,n)=>f(this,null,function*(){return St(e(yield this.parseResponse(t,n),n),n.response)}))}asResponse(){return this.responsePromise.then(e=>e.response)}withResponse(){return f(this,null,function*(){const[e,t]=yield Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}})}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(oe(this,gt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}gt=new WeakMap;class Ot{constructor(e,t,n,s){vt.set(this,void 0),re(this,vt,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}getNextPage(){return f(this,null,function*(){const e=this.nextPageRequestOptions();if(!e)throw new ce("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return yield oe(this,vt,"f").requestAPIList(this.constructor,e)})}iterPages(){return m(this,null,function*(){let e=this;for(yield e;e.hasNextPage();)e=yield new p(e.getNextPage()),yield e})}[(vt=new WeakMap,Symbol.asyncIterator)](){return m(this,null,function*(){try{for(var e,t,n,s=g(this.iterPages());e=!(t=yield new p(s.next())).done;e=!1){const e=t.value;for(const t of e.getPaginatedItems())yield t}}catch(t){n=[t]}finally{try{e&&(t=s.return)&&(yield new p(t.call(s)))}finally{if(n)throw n[0]}}})}}class At extends xt{constructor(e,t,n){super(e,t,(e,t)=>f(this,null,function*(){return new n(e,t.response,yield wt(e,t),t.options)}))}[Symbol.asyncIterator](){return m(this,null,function*(){const e=yield new p(this);try{for(var t,n,s,r=g(e);t=!(n=yield new p(r.next())).done;t=!1){const e=n.value;yield e}}catch(n){s=[n]}finally{try{t&&(n=r.return)&&(yield new p(n.call(r)))}finally{if(s)throw s[0]}}})}}class $t extends Ot{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return null!=(e=this.data)?e:[]}nextPageRequestOptions(){return null}}class It extends Ot{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){var e;return null!=(e=this.data)?e:[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;const t=this.getPaginatedItems(),n=null==(e=t[t.length-1])?void 0:e.id;return n?d(u({},this.options),{query:d(u({},(s=this.options.query,"object"!=typeof s?{}:null!=s?s:{})),{after:n})}):null;var s}}const Rt=()=>{var e;if("undefined"==typeof File){const{process:t}=globalThis,n="string"==typeof(null==(e=null==t?void 0:t.versions)?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function kt(e,t,n){return Rt(),new File(e,null!=t?t:"unknown_file",n)}function Et(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Lt=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],Pt=(e,t)=>f(void 0,null,function*(){return d(u({},e),{body:yield jt(e.body,t)})}),Tt=new WeakMap;const jt=(e,t)=>f(void 0,null,function*(){if(!(yield function(e){const t="function"==typeof e?e:e.fetch,n=Tt.get(t);if(n)return n;const s=(()=>f(this,null,function*(){try{const e="Response"in t?t.Response:(yield t("data:,")).constructor,n=new FormData;return n.toString()!==(yield new e(n).text())}catch(e){return!0}}))();return Tt.set(t,s),s}(t)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return yield Promise.all(Object.entries(e||{}).map(([e,t])=>Ct(n,e,t))),n}),Ct=(e,t,n)=>f(void 0,null,function*(){if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,kt([yield n.blob()],Et(n)));else if(Lt(n))e.append(t,kt([yield new Response(Ne(n)).blob()],Et(n)));else if((e=>e instanceof Blob&&"name"in e)(n))e.append(t,n,Et(n));else if(Array.isArray(n))yield Promise.all(n.map(n=>Ct(e,t+"[]",n)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);yield Promise.all(Object.entries(n).map(([n,s])=>Ct(e,`${t}[${n}]`,s)))}}}),Nt=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;function Mt(e){return f(this,null,function*(){var t;let n=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)n.push(e);else if(Nt(e))n.push(e instanceof Blob?e:yield e.arrayBuffer());else{if(!Lt(e)){const n=null==(t=null==e?void 0:e.constructor)?void 0:t.name;throw new Error(`Unexpected data type: ${typeof e}${n?`; constructor: ${n}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}try{for(var s,r,o,i=g(e);s=!(r=yield i.next()).done;s=!1){const e=r.value;n.push(...yield Mt(e))}}catch(r){o=[r]}finally{try{s&&(r=i.return)&&(yield r.call(i))}finally{if(o)throw o[0]}}}return n})}class Dt{constructor(e){this._client=e}}function Bt(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const qt=Object.freeze(Object.create(null)),Wt=((e=Bt)=>function(t,...n){if(1===t.length)return t[0];let s=!1;const r=[],o=t.reduce((t,o,i)=>{var a,l,c;/[?#]/.test(o)&&(s=!0);const u=n[i];let d=(s?encodeURIComponent:e)(""+u);return i!==n.length&&(null==u||"object"==typeof u&&u.toString===(null==(c=Object.getPrototypeOf(null!=(l=Object.getPrototypeOf(null!=(a=u.hasOwnProperty)?a:qt))?l:qt))?void 0:c.toString))&&(d=u+"",r.push({start:t.length+o.length,length:d.length,error:`Value of type ${Object.prototype.toString.call(u).slice(8,-1)} is not a valid path parameter`})),t+o+(i===n.length?"":d)},""),i=o.split(/[?#]/,1)[0],a=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;null!==(l=a.exec(i));)r.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,n)=>{const s=" ".repeat(n.start-e),r="^".repeat(n.length);return e=n.start+n.length,t+s+r},"");throw new ce(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${o}\n${t}`)}return o})(Bt);let Ut=class extends Dt{list(e,t={},n){return this._client.getAPIList(Wt`/chat/completions/${e}/messages`,It,u({query:t},n))}};function Ft(e){return"function"==typeof e.parse}const Ht=e=>"assistant"===(null==e?void 0:e.role),Xt=e=>"tool"===(null==e?void 0:e.role);var Kt,Jt,zt,Vt,Gt,Yt,Qt,Zt,en,tn,nn,sn,rn,on,an,ln,cn,un,dn,hn,fn;class pn{constructor(){Kt.add(this),this.controller=new AbortController,Jt.set(this,void 0),zt.set(this,()=>{}),Vt.set(this,()=>{}),Gt.set(this,void 0),Yt.set(this,()=>{}),Qt.set(this,()=>{}),Zt.set(this,{}),en.set(this,!1),tn.set(this,!1),nn.set(this,!1),sn.set(this,!1),re(this,Jt,new Promise((e,t)=>{re(this,zt,e),re(this,Vt,t)})),re(this,Gt,new Promise((e,t)=>{re(this,Yt,e),re(this,Qt,t)})),oe(this,Jt,"f").catch(()=>{}),oe(this,Gt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},oe(this,Kt,"m",rn).bind(this))},0)}_connected(){this.ended||(oe(this,zt,"f").call(this),this._emit("connect"))}get ended(){return oe(this,en,"f")}get errored(){return oe(this,tn,"f")}get aborted(){return oe(this,nn,"f")}abort(){this.controller.abort()}on(e,t){return(oe(this,Zt,"f")[e]||(oe(this,Zt,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=oe(this,Zt,"f")[e];if(!n)return this;const s=n.findIndex(e=>e.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(oe(this,Zt,"f")[e]||(oe(this,Zt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{re(this,sn,!0),"error"!==e&&this.once("error",n),this.once(e,t)})}done(){return f(this,null,function*(){re(this,sn,!0),yield oe(this,Gt,"f")})}_emit(e,...t){if(oe(this,en,"f"))return;"end"===e&&(re(this,en,!0),oe(this,Yt,"f").call(this));const n=oe(this,Zt,"f")[e];if(n&&(oe(this,Zt,"f")[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return oe(this,sn,"f")||(null==n?void 0:n.length)||Promise.reject(e),oe(this,Vt,"f").call(this,e),oe(this,Qt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];oe(this,sn,"f")||(null==n?void 0:n.length)||Promise.reject(e),oe(this,Vt,"f").call(this,e),oe(this,Qt,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function mn(e){return"auto-parseable-response-format"===(null==e?void 0:e.$brand)}function yn(e){return"auto-parseable-tool"===(null==e?void 0:e.$brand)}function gn(e,t){const n=e.choices.map(e=>{var n,s;if("length"===e.finish_reason)throw new Se;if("content_filter"===e.finish_reason)throw new xe;return d(u({},e),{message:d(u(u({},e.message),e.message.tool_calls?{tool_calls:null!=(s=null==(n=e.message.tool_calls)?void 0:n.map(e=>function(e,t){var n;const s=null==(n=e.tools)?void 0:n.find(e=>{var n;return(null==(n=e.function)?void 0:n.name)===t.function.name});return d(u({},t),{function:d(u({},t.function),{parsed_arguments:yn(s)?s.$parseRaw(t.function.arguments):(null==s?void 0:s.function.strict)?JSON.parse(t.function.arguments):null})})}(t,e)))?s:void 0}:void 0),{parsed:e.message.content&&!e.message.refusal?vn(t,e.message.content):null})})});return d(u({},e),{choices:n})}function vn(e,t){var n,s;if("json_schema"!==(null==(n=e.response_format)?void 0:n.type))return null;if("json_schema"===(null==(s=e.response_format)?void 0:s.type)){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function _n(e,t){var n;if(!e)return!1;const s=null==(n=e.tools)?void 0:n.find(e=>{var n;return(null==(n=e.function)?void 0:n.name)===t.function.name});return yn(s)||(null==s?void 0:s.function.strict)||!1}function bn(e){var t,n;return!!mn(e.response_format)||null!=(n=null==(t=e.tools)?void 0:t.some(e=>yn(e)||"function"===e.type&&!0===e.function.strict))&&n}Jt=new WeakMap,zt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,sn=new WeakMap,Kt=new WeakSet,rn=function(e){if(re(this,tn,!0),e instanceof Error&&"AbortError"===e.name&&(e=new de),e instanceof de)return re(this,nn,!0),this._emit("abort",e);if(e instanceof ce)return this._emit("error",e);if(e instanceof Error){const t=new ce(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ce(String(e)))};const wn=10;class Sn extends pn{constructor(){super(...arguments),on.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var t;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=null==(t=e.choices[0])?void 0:t.message;return n&&this._addMessage(n),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),Xt(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Ht(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionToolCall",n.function)}finalChatCompletion(){return f(this,null,function*(){yield this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ce("stream ended without producing a ChatCompletion");return e})}finalContent(){return f(this,null,function*(){return yield this.done(),oe(this,on,"m",an).call(this)})}finalMessage(){return f(this,null,function*(){return yield this.done(),oe(this,on,"m",ln).call(this)})}finalFunctionToolCall(){return f(this,null,function*(){return yield this.done(),oe(this,on,"m",cn).call(this)})}finalFunctionToolCallResult(){return f(this,null,function*(){return yield this.done(),oe(this,on,"m",un).call(this)})}totalUsage(){return f(this,null,function*(){return yield this.done(),oe(this,on,"m",dn).call(this)})}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=oe(this,on,"m",ln).call(this);t&&this._emit("finalMessage",t);const n=oe(this,on,"m",an).call(this);n&&this._emit("finalContent",n);const s=oe(this,on,"m",cn).call(this);s&&this._emit("finalFunctionToolCall",s);const r=oe(this,on,"m",un).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",oe(this,on,"m",dn).call(this))}_createChatCompletion(e,t,n){return f(this,null,function*(){const s=null==n?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),oe(this,on,"m",hn).call(this,t);const r=yield e.chat.completions.create(d(u({},t),{stream:!1}),d(u({},n),{signal:this.controller.signal}));return this._connected(),this._addChatCompletion(gn(r,t))})}_runChatCompletion(e,t,n){return f(this,null,function*(){for(const e of t.messages)this._addMessage(e,!1);return yield this._createChatCompletion(e,t,n)})}_runTools(e,t,n){return f(this,null,function*(){var s,r,o;const i="tool",a=t,{tool_choice:l="auto",stream:c}=a,f=h(a,["tool_choice","stream"]),p="string"!=typeof l&&(null==(s=null==l?void 0:l.function)?void 0:s.name),{maxChatCompletions:m=wn}=n||{},y=t.tools.map(e=>{if(yn(e)){if(!e.$callback)throw new ce("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),g={};for(const e of y)"function"===e.type&&(g[e.function.name||e.function.function.name]=e.function);const v="tools"in t?y.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<m;++t){const t=null==(r=(yield this._createChatCompletion(e,d(u({},f),{tool_choice:l,tools:v,messages:[...this.messages]}),n)).choices[0])?void 0:r.message;if(!t)throw new ce("missing message in ChatCompletion response");if(!(null==(o=t.tool_calls)?void 0:o.length))return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:s}=e.function,r=g[n];if(!r){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(g).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:t,content:e});continue}if(p&&p!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(p)} requested. Please try again`;this._addMessage({role:i,tool_call_id:t,content:e});continue}let o;try{o=Ft(r)?yield r.parse(s):s}catch(_){const e=_ instanceof Error?_.message:String(_);this._addMessage({role:i,tool_call_id:t,content:e});continue}const a=yield r.function(o,this),l=oe(this,on,"m",fn).call(this,a);if(this._addMessage({role:i,tool_call_id:t,content:l}),p)return}}})}}on=new WeakSet,an=function(){var e;return null!=(e=oe(this,on,"m",ln).call(this).content)?e:null},ln=function(){var e,t;let n=this.messages.length;for(;n-- >0;){const s=this.messages[n];if(Ht(s)){return d(u({},s),{content:null!=(e=s.content)?e:null,refusal:null!=(t=s.refusal)?t:null})}}throw new ce("stream ended without producing a ChatCompletionMessage with role=assistant")},cn=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Ht(s)&&(null==(e=null==s?void 0:s.tool_calls)?void 0:e.length))return null==(t=s.tool_calls.at(-1))?void 0:t.function}},un=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Xt(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>{var n;return"assistant"===e.role&&(null==(n=e.tool_calls)?void 0:n.some(e=>"function"===e.type&&e.id===t.tool_call_id))}))return t.content}},dn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},hn=function(e){if(null!=e.n&&e.n>1)throw new ce("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},fn=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class xn extends Sn{static runTools(e,t,n){const s=new xn,r=d(u({},n),{headers:d(u({},null==n?void 0:n.headers),{"X-Stainless-Helper-Method":"runTools"})});return s._run(()=>s._runTools(e,t,r)),s}_addMessage(e,t=!0){super._addMessage(e,t),Ht(e)&&e.content&&this._emit("content",e.content)}}const On=1,An=2,$n=4,In=8,Rn=16,kn=32,En=64,Ln=128,Pn=256,Tn=511;class jn extends Error{}class Cn extends Error{}const Nn=(e,t)=>{const n=e.length;let s=0;const r=e=>{throw new jn(`${e} at position ${s}`)},o=e=>{throw new Cn(`${e} at position ${s}`)},i=()=>(d(),s>=n&&r("Unexpected end of input"),'"'===e[s]?a():"{"===e[s]?l():"["===e[s]?c():"null"===e.substring(s,s+4)||Rn&t&&n-s<4&&"null".startsWith(e.substring(s))?(s+=4,null):"true"===e.substring(s,s+4)||kn&t&&n-s<4&&"true".startsWith(e.substring(s))?(s+=4,!0):"false"===e.substring(s,s+5)||kn&t&&n-s<5&&"false".startsWith(e.substring(s))?(s+=5,!1):"Infinity"===e.substring(s,s+8)||Ln&t&&n-s<8&&"Infinity".startsWith(e.substring(s))?(s+=8,1/0):"-Infinity"===e.substring(s,s+9)||Pn&t&&1<n-s&&n-s<9&&"-Infinity".startsWith(e.substring(s))?(s+=9,-1/0):"NaN"===e.substring(s,s+3)||En&t&&n-s<3&&"NaN".startsWith(e.substring(s))?(s+=3,NaN):u()),a=()=>{const i=s;let a=!1;for(s++;s<n&&('"'!==e[s]||a&&"\\"===e[s-1]);)a="\\"===e[s]&&!a,s++;if('"'==e.charAt(s))try{return JSON.parse(e.substring(i,++s-Number(a)))}catch(l){o(String(l))}else if(On&t)try{return JSON.parse(e.substring(i,s-Number(a))+'"')}catch(l){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{s++,d();const o={};try{for(;"}"!==e[s];){if(d(),s>=n&&In&t)return o;const r=a();d(),s++;try{const e=i();Object.defineProperty(o,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(l){if(In&t)return o;throw l}d(),","===e[s]&&s++}}catch(l){if(In&t)return o;r("Expected '}' at end of object")}return s++,o},c=()=>{s++;const n=[];try{for(;"]"!==e[s];)n.push(i()),d(),","===e[s]&&s++}catch(o){if($n&t)return n;r("Expected ']' at end of array")}return s++,n},u=()=>{if(0===s){"-"===e&&An&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(a){if(An&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(l){}o(String(a))}}const i=s;for("-"===e[s]&&s++;e[s]&&!",]}".includes(e[s]);)s++;s!=n||An&t||r("Unterminated number literal");try{return JSON.parse(e.substring(i,s))}catch(a){"-"===e.substring(i,s)&&An&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(l){o(String(l))}}},d=()=>{for(;s<n&&" \n\r\t".includes(e[s]);)s++};return i()},Mn=e=>function(e,t=Tn){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Nn(e.trim(),t)}(e,Tn^An);var Dn,Bn,qn,Wn,Un,Fn,Hn,Xn,Kn,Jn,zn,Vn;class Gn extends Sn{constructor(e){super(),Dn.add(this),Bn.set(this,void 0),qn.set(this,void 0),Wn.set(this,void 0),re(this,Bn,e),re(this,qn,[])}get currentChatCompletionSnapshot(){return oe(this,Wn,"f")}static fromReadableStream(e){const t=new Gn(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Gn(t);return s._run(()=>s._runChatCompletion(e,d(u({},t),{stream:!0}),d(u({},n),{headers:d(u({},null==n?void 0:n.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}_createChatCompletion(e,t,n){return f(this,null,function*(){var s,o,i,l;o=Gn.prototype,i=this,l="_createChatCompletion",a(r(o),l,i);const c=null==n?void 0:n.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),oe(this,Dn,"m",Un).call(this);const h=yield e.chat.completions.create(d(u({},t),{stream:!0}),d(u({},n),{signal:this.controller.signal}));this._connected();try{for(var f,p,m,y=g(h);f=!(p=yield y.next()).done;f=!1){const e=p.value;oe(this,Dn,"m",Hn).call(this,e)}}catch(p){m=[p]}finally{try{f&&(p=y.return)&&(yield p.call(y))}finally{if(m)throw m[0]}}if(null==(s=h.controller.signal)?void 0:s.aborted)throw new de;return this._addChatCompletion(oe(this,Dn,"m",Jn).call(this))})}_fromReadableStream(e,t){return f(this,null,function*(){var n;const s=null==t?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),oe(this,Dn,"m",Un).call(this),this._connected();const r=_t.fromReadableStream(e,this.controller);let o;try{for(var i,a,l,c=g(r);i=!(a=yield c.next()).done;i=!1){const e=a.value;o&&o!==e.id&&this._addChatCompletion(oe(this,Dn,"m",Jn).call(this)),oe(this,Dn,"m",Hn).call(this,e),o=e.id}}catch(a){l=[a]}finally{try{i&&(a=c.return)&&(yield a.call(c))}finally{if(l)throw l[0]}}if(null==(n=r.controller.signal)?void 0:n.aborted)throw new de;return this._addChatCompletion(oe(this,Dn,"m",Jn).call(this))})}[(Bn=new WeakMap,qn=new WeakMap,Wn=new WeakMap,Dn=new WeakSet,Un=function(){this.ended||re(this,Wn,void 0)},Fn=function(e){let t=oe(this,qn,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},oe(this,qn,"f")[e.index]=t,t)},Hn=function(e){var t,n,s,r,o,i,a,l,c,u,d,h,f,p,m,y,g,v,_,b;if(this.ended)return;const w=oe(this,Dn,"m",Vn).call(this,e);this._emit("chunk",e,w);for(const S of e.choices){const e=w.choices[S.index];null!=S.delta.content&&"assistant"===(null==(t=e.message)?void 0:t.role)&&(null==(n=e.message)?void 0:n.content)&&(this._emit("content",S.delta.content,e.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=S.delta.refusal&&"assistant"===(null==(s=e.message)?void 0:s.role)&&(null==(r=e.message)?void 0:r.refusal)&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:e.message.refusal}),null!=(null==(o=S.logprobs)?void 0:o.content)&&"assistant"===(null==(i=e.message)?void 0:i.role)&&this._emit("logprobs.content.delta",{content:null==(a=S.logprobs)?void 0:a.content,snapshot:null!=(c=null==(l=e.logprobs)?void 0:l.content)?c:[]}),null!=(null==(u=S.logprobs)?void 0:u.refusal)&&"assistant"===(null==(d=e.message)?void 0:d.role)&&this._emit("logprobs.refusal.delta",{refusal:null==(h=S.logprobs)?void 0:h.refusal,snapshot:null!=(p=null==(f=e.logprobs)?void 0:f.refusal)?p:[]});const x=oe(this,Dn,"m",Fn).call(this,e);e.finish_reason&&(oe(this,Dn,"m",Kn).call(this,e),null!=x.current_tool_call_index&&oe(this,Dn,"m",Xn).call(this,e,x.current_tool_call_index));for(const t of null!=(m=S.delta.tool_calls)?m:[])x.current_tool_call_index!==t.index&&(oe(this,Dn,"m",Kn).call(this,e),null!=x.current_tool_call_index&&oe(this,Dn,"m",Xn).call(this,e,x.current_tool_call_index)),x.current_tool_call_index=t.index;for(const t of null!=(y=S.delta.tool_calls)?y:[]){const n=null==(g=e.message.tool_calls)?void 0:g[t.index];(null==n?void 0:n.type)&&("function"===(null==n?void 0:n.type)?this._emit("tool_calls.function.arguments.delta",{name:null==(v=n.function)?void 0:v.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:null!=(b=null==(_=t.function)?void 0:_.arguments)?b:""}):Qn(null==n?void 0:n.type))}}},Xn=function(e,t){var n,s,r;if(oe(this,Dn,"m",Fn).call(this,e).done_tool_calls.has(t))return;const o=null==(n=e.message.tool_calls)?void 0:n[t];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if("function"===o.type){const e=null==(r=null==(s=oe(this,Bn,"f"))?void 0:s.tools)?void 0:r.find(e=>"function"===e.type&&e.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:t,arguments:o.function.arguments,parsed_arguments:yn(e)?e.$parseRaw(o.function.arguments):(null==e?void 0:e.function.strict)?JSON.parse(o.function.arguments):null})}else o.type},Kn=function(e){var t,n;const s=oe(this,Dn,"m",Fn).call(this,e);if(e.message.content&&!s.content_done){s.content_done=!0;const t=oe(this,Dn,"m",zn).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),(null==(t=e.logprobs)?void 0:t.content)&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),(null==(n=e.logprobs)?void 0:n.refusal)&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Jn=function(){if(this.ended)throw new ce("stream has ended, this shouldn't happen");const e=oe(this,Wn,"f");if(!e)throw new ce("request ended without sending any chunks");return re(this,Wn,void 0),re(this,qn,[]),function(e,t){const n=e,{id:s,choices:r,created:o,model:i,system_fingerprint:a}=n,l=h(n,["id","choices","created","model","system_fingerprint"]),c=u(d(u({},l),{id:s,choices:r.map(t=>{var n,s,r,o=t,{message:i,finish_reason:a,index:l,logprobs:c}=o,f=h(o,["message","finish_reason","index","logprobs"]);if(!a)throw new ce(`missing finish_reason for choice ${l}`);const p=i,{content:m=null,function_call:y,tool_calls:g}=p,v=h(p,["content","function_call","tool_calls"]),_=i.role;if(!_)throw new ce(`missing role for choice ${l}`);if(y){const{arguments:e,name:t}=y;if(null==e)throw new ce(`missing function_call.arguments for choice ${l}`);if(!t)throw new ce(`missing function_call.name for choice ${l}`);return d(u({},f),{message:{content:m,function_call:{arguments:e,name:t},role:_,refusal:null!=(n=i.refusal)?n:null},finish_reason:a,index:l,logprobs:c})}return d(u({},f),g?{index:l,finish_reason:a,logprobs:c,message:d(u({},v),{role:_,content:m,refusal:null!=(s=i.refusal)?s:null,tool_calls:g.map((t,n)=>{const s=t,{function:r,type:o,id:i}=s,a=h(s,["function","type","id"]),c=r||{},{arguments:f,name:p}=c,m=h(c,["arguments","name"]);if(null==i)throw new ce(`missing choices[${l}].tool_calls[${n}].id\n${Yn(e)}`);if(null==o)throw new ce(`missing choices[${l}].tool_calls[${n}].type\n${Yn(e)}`);if(null==p)throw new ce(`missing choices[${l}].tool_calls[${n}].function.name\n${Yn(e)}`);if(null==f)throw new ce(`missing choices[${l}].tool_calls[${n}].function.arguments\n${Yn(e)}`);return d(u({},a),{id:i,type:o,function:d(u({},m),{name:p,arguments:f})})})})}:{message:d(u({},v),{content:m,role:_,refusal:null!=(r=i.refusal)?r:null}),finish_reason:a,index:l,logprobs:c})}),created:o,model:i,object:"chat.completion"}),a?{system_fingerprint:a}:{});return function(e,t){return t&&bn(t)?gn(e,t):d(u({},e),{choices:e.choices.map(e=>d(u({},e),{message:u(d(u({},e.message),{parsed:null}),e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0)}))})}(c,t)}(e,oe(this,Bn,"f"))},zn=function(){var e;const t=null==(e=oe(this,Bn,"f"))?void 0:e.response_format;return mn(t)?t:null},Vn=function(e){var t,n,s,r,o,i;let a=oe(this,Wn,"f");const l=e,{choices:c}=l,f=h(l,["choices"]);a?Object.assign(a,f):a=re(this,Wn,d(u({},f),{choices:[]}));for(const d of e.choices){const e=d,{delta:l,finish_reason:c,index:f,logprobs:p=null}=e,m=h(e,["delta","finish_reason","index","logprobs"]);let y=a.choices[f];if(y||(y=a.choices[f]=u({finish_reason:c,index:f,message:{},logprobs:p},m)),p)if(y.logprobs){const e=p,{content:t,refusal:n}=e,o=h(e,["content","refusal"]);Object.assign(y.logprobs,o),t&&(null!=(s=y.logprobs).content||(s.content=[]),y.logprobs.content.push(...t)),n&&(null!=(r=y.logprobs).refusal||(r.refusal=[]),y.logprobs.refusal.push(...n))}else y.logprobs=Object.assign({},p);if(c&&(y.finish_reason=c,oe(this,Bn,"f")&&bn(oe(this,Bn,"f")))){if("length"===c)throw new Se;if("content_filter"===c)throw new xe}if(Object.assign(y,m),!l)continue;const g=l,{content:v,refusal:_,function_call:b,role:w,tool_calls:S}=g,x=h(g,["content","refusal","function_call","role","tool_calls"]);if(Object.assign(y.message,x),_&&(y.message.refusal=(y.message.refusal||"")+_),w&&(y.message.role=w),b&&(y.message.function_call?(b.name&&(y.message.function_call.name=b.name),b.arguments&&(null!=(o=y.message.function_call).arguments||(o.arguments=""),y.message.function_call.arguments+=b.arguments)):y.message.function_call=b),v&&(y.message.content=(y.message.content||"")+v,!y.message.refusal&&oe(this,Dn,"m",zn).call(this)&&(y.message.parsed=Mn(y.message.content))),S){y.message.tool_calls||(y.message.tool_calls=[]);for(const e of S){const s=e,{index:r,id:o,type:a,function:l}=s,c=h(s,["index","id","type","function"]),u=null!=(t=(i=y.message.tool_calls)[r])?t:i[r]={};Object.assign(u,c),o&&(u.id=o),a&&(u.type=a),l&&(null!=u.function||(u.function={name:null!=(n=l.name)?n:"",arguments:""})),(null==l?void 0:l.name)&&(u.function.name=l.name),(null==l?void 0:l.arguments)&&(u.function.arguments+=l.arguments,_n(oe(this,Bn,"f"),u)&&(u.function.parsed_arguments=Mn(u.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:()=>f(this,null,function*(){if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}toReadableStream(){return new _t(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Yn(e){return JSON.stringify(e)}function Qn(e){}class Zn extends Gn{static fromReadableStream(e){const t=new Zn(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const s=new Zn(t),r=d(u({},n),{headers:d(u({},null==n?void 0:n.headers),{"X-Stainless-Helper-Method":"runTools"})});return s._run(()=>s._runTools(e,t,r)),s}}let es=class extends Dt{constructor(){super(...arguments),this.messages=new Ut(this._client)}create(e,t){var n;return this._client.post("/chat/completions",d(u({body:e},t),{stream:null!=(n=e.stream)&&n}))}retrieve(e,t){return this._client.get(Wt`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(Wt`/chat/completions/${e}`,u({body:t},n))}list(e={},t){return this._client.getAPIList("/chat/completions",It,u({query:e},t))}delete(e,t){return this._client.delete(Wt`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of null!=e?e:[]){if("function"!==t.type)throw new ce(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new ce(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,d(u({},t),{headers:d(u({},null==t?void 0:t.headers),{"X-Stainless-Helper-Method":"chat.completions.parse"})}))._thenUnwrap(t=>gn(t,e))}runTools(e,t){return e.stream?Zn.runTools(this._client,e,t):xn.runTools(this._client,e,t)}stream(e,t){return Gn.createChatCompletion(this._client,e,t)}};es.Messages=Ut;class ts extends Dt{constructor(){super(...arguments),this.completions=new es(this._client)}}ts.Completions=es;const ns=Symbol("brand.privateNullableHeaders");function*ss(e){if(!e)return;if(ns in e){const{values:t,nulls:n}=e;yield*y(t.entries());for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():Ie(e)?t=e:(n=!0,t=Object.entries(null!=e?e:{}));for(let s of t){const e=s[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=Ie(s[1])?s[1]:[s[1]];let r=!1;for(const s of t)void 0!==s&&(n&&!r&&(r=!0,yield[e,null]),yield[e,s])}}const rs=e=>{const t=new Headers,n=new Set;for(const s of e){const e=new Set;for(const[r,o]of ss(s)){const s=r.toLowerCase();e.has(s)||(t.delete(r),e.add(s)),null===o?(t.delete(r),n.add(s)):(t.append(r,o),n.delete(s))}}return{[ns]:!0,values:t,nulls:n}};class os extends Dt{create(e,t){return this._client.post("/audio/speech",d(u({body:e},t),{headers:rs([{Accept:"application/octet-stream"},null==t?void 0:t.headers]),__binaryResponse:!0}))}}class is extends Dt{create(e,t){var n;return this._client.post("/audio/transcriptions",Pt(d(u({body:e},t),{stream:null!=(n=e.stream)&&n,__metadata:{model:e.model}}),this._client))}}class as extends Dt{create(e,t){return this._client.post("/audio/translations",Pt(d(u({body:e},t),{__metadata:{model:e.model}}),this._client))}}class ls extends Dt{constructor(){super(...arguments),this.transcriptions=new is(this._client),this.translations=new as(this._client),this.speech=new os(this._client)}}ls.Transcriptions=is,ls.Translations=as,ls.Speech=os;class cs extends Dt{create(e,t){return this._client.post("/batches",u({body:e},t))}retrieve(e,t){return this._client.get(Wt`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",It,u({query:e},t))}cancel(e,t){return this._client.post(Wt`/batches/${e}/cancel`,t)}}class us extends Dt{create(e,t){return this._client.post("/assistants",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}retrieve(e,t){return this._client.get(Wt`/assistants/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}update(e,t,n){return this._client.post(Wt`/assistants/${e}`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e={},t){return this._client.getAPIList("/assistants",It,d(u({query:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}delete(e,t){return this._client.delete(Wt`/assistants/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}}class ds extends Dt{create(e,t){return this._client.post("/realtime/sessions",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}}class hs extends Dt{create(e,t){return this._client.post("/realtime/transcription_sessions",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}}class fs extends Dt{constructor(){super(...arguments),this.sessions=new ds(this._client),this.transcriptionSessions=new hs(this._client)}}fs.Sessions=ds,fs.TranscriptionSessions=hs;class ps extends Dt{create(e,t,n){return this._client.post(Wt`/threads/${e}/messages`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}retrieve(e,t,n){const{thread_id:s}=t;return this._client.get(Wt`/threads/${s}/messages/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}update(e,t,n){const s=t,{thread_id:r}=s,o=h(s,["thread_id"]);return this._client.post(Wt`/threads/${r}/messages/${e}`,d(u({body:o},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e,t={},n){return this._client.getAPIList(Wt`/threads/${e}/messages`,It,d(u({query:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}delete(e,t,n){const{thread_id:s}=t;return this._client.delete(Wt`/threads/${s}/messages/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}}class ms extends Dt{retrieve(e,t,n){const s=t,{thread_id:r,run_id:o}=s,i=h(s,["thread_id","run_id"]);return this._client.get(Wt`/threads/${r}/runs/${o}/steps/${e}`,d(u({query:i},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e,t,n){const s=t,{thread_id:r}=s,o=h(s,["thread_id"]);return this._client.getAPIList(Wt`/threads/${r}/runs/${e}/steps`,It,d(u({query:o},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}}var ys={};const gs=e=>{var t,n,s,r,o;return void 0!==globalThis.process?null!=(n=null==(t=null==ys?void 0:ys[e])?void 0:t.trim())?n:void 0:void 0!==globalThis.Deno?null==(o=null==(r=null==(s=globalThis.Deno.env)?void 0:s.get)?void 0:r.call(s,e))?void 0:o.trim():void 0};var vs,_s,bs,ws,Ss,xs,Os,As,$s,Is,Rs,ks,Es,Ls,Ps,Ts,js,Cs,Ns,Ms,Ds,Bs,qs;class Ws extends pn{constructor(){super(...arguments),vs.add(this),bs.set(this,[]),ws.set(this,{}),Ss.set(this,{}),xs.set(this,void 0),Os.set(this,void 0),As.set(this,void 0),$s.set(this,void 0),Is.set(this,void 0),Rs.set(this,void 0),ks.set(this,void 0),Es.set(this,void 0),Ls.set(this,void 0)}[(bs=new WeakMap,ws=new WeakMap,Ss=new WeakMap,xs=new WeakMap,Os=new WeakMap,As=new WeakMap,$s=new WeakMap,Is=new WeakMap,Rs=new WeakMap,ks=new WeakMap,Es=new WeakMap,Ls=new WeakMap,vs=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:()=>f(this,null,function*(){if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}static fromReadableStream(e){const t=new _s;return t._run(()=>t._fromReadableStream(e)),t}_fromReadableStream(e,t){return f(this,null,function*(){var n;const s=null==t?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=_t.fromReadableStream(e,this.controller);try{for(var o,i,a,l=g(r);o=!(i=yield l.next()).done;o=!1){const e=i.value;oe(this,vs,"m",Ps).call(this,e)}}catch(i){a=[i]}finally{try{o&&(i=l.return)&&(yield i.call(l))}finally{if(a)throw a[0]}}if(null==(n=r.controller.signal)?void 0:n.aborted)throw new de;return this._addRun(oe(this,vs,"m",Ts).call(this))})}toReadableStream(){return new _t(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s){const r=new _s;return r._run(()=>r._runToolAssistantStream(e,t,n,d(u({},s),{headers:d(u({},null==s?void 0:s.headers),{"X-Stainless-Helper-Method":"stream"})}))),r}_createToolAssistantStream(e,t,n,s){return f(this,null,function*(){var r;const o=null==s?void 0:s.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const i=d(u({},n),{stream:!0}),a=yield e.submitToolOutputs(t,i,d(u({},s),{signal:this.controller.signal}));this._connected();try{for(var l,c,h,f=g(a);l=!(c=yield f.next()).done;l=!1){const e=c.value;oe(this,vs,"m",Ps).call(this,e)}}catch(c){h=[c]}finally{try{l&&(c=f.return)&&(yield c.call(f))}finally{if(h)throw h[0]}}if(null==(r=a.controller.signal)?void 0:r.aborted)throw new de;return this._addRun(oe(this,vs,"m",Ts).call(this))})}static createThreadAssistantStream(e,t,n){const s=new _s;return s._run(()=>s._threadAssistantStream(e,t,d(u({},n),{headers:d(u({},null==n?void 0:n.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}static createAssistantStream(e,t,n,s){const r=new _s;return r._run(()=>r._runAssistantStream(e,t,n,d(u({},s),{headers:d(u({},null==s?void 0:s.headers),{"X-Stainless-Helper-Method":"stream"})}))),r}currentEvent(){return oe(this,ks,"f")}currentRun(){return oe(this,Es,"f")}currentMessageSnapshot(){return oe(this,xs,"f")}currentRunStepSnapshot(){return oe(this,Ls,"f")}finalRunSteps(){return f(this,null,function*(){return yield this.done(),Object.values(oe(this,ws,"f"))})}finalMessages(){return f(this,null,function*(){return yield this.done(),Object.values(oe(this,Ss,"f"))})}finalRun(){return f(this,null,function*(){if(yield this.done(),!oe(this,Os,"f"))throw Error("Final run was not received.");return oe(this,Os,"f")})}_createThreadAssistantStream(e,t,n){return f(this,null,function*(){var s;const r=null==n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const o=d(u({},t),{stream:!0}),i=yield e.createAndRun(o,d(u({},n),{signal:this.controller.signal}));this._connected();try{for(var a,l,c,h=g(i);a=!(l=yield h.next()).done;a=!1){const e=l.value;oe(this,vs,"m",Ps).call(this,e)}}catch(l){c=[l]}finally{try{a&&(l=h.return)&&(yield l.call(h))}finally{if(c)throw c[0]}}if(null==(s=i.controller.signal)?void 0:s.aborted)throw new de;return this._addRun(oe(this,vs,"m",Ts).call(this))})}_createAssistantStream(e,t,n,s){return f(this,null,function*(){var r;const o=null==s?void 0:s.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const i=d(u({},n),{stream:!0}),a=yield e.create(t,i,d(u({},s),{signal:this.controller.signal}));this._connected();try{for(var l,c,h,f=g(a);l=!(c=yield f.next()).done;l=!1){const e=c.value;oe(this,vs,"m",Ps).call(this,e)}}catch(c){h=[c]}finally{try{l&&(c=f.return)&&(yield c.call(f))}finally{if(h)throw h[0]}}if(null==(r=a.controller.signal)?void 0:r.aborted)throw new de;return this._addRun(oe(this,vs,"m",Ts).call(this))})}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof s)t+=s;else if("number"==typeof t&&"number"==typeof s)t+=s;else{if(!Re(t)||!Re(s)){if(Array.isArray(t)&&Array.isArray(s)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...s);continue}for(const e of s){if(!Re(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const s=t[n];null==s?t.push(e):t[n]=this.accumulateDelta(s,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${t}`)}t=this.accumulateDelta(t,s)}e[n]=t}else e[n]=s;else e[n]=s}return e}_addRun(e){return e}_threadAssistantStream(e,t,n){return f(this,null,function*(){return yield this._createThreadAssistantStream(t,e,n)})}_runAssistantStream(e,t,n,s){return f(this,null,function*(){return yield this._createAssistantStream(t,e,n,s)})}_runToolAssistantStream(e,t,n,s){return f(this,null,function*(){return yield this._createToolAssistantStream(t,e,n,s)})}}_s=Ws,Ps=function(e){if(!this.ended)switch(re(this,ks,e),oe(this,vs,"m",Ns).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":oe(this,vs,"m",qs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":oe(this,vs,"m",Cs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":oe(this,vs,"m",js).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ts=function(){if(this.ended)throw new ce("stream has ended, this shouldn't happen");if(!oe(this,Os,"f"))throw Error("Final run has not been received");return oe(this,Os,"f")},js=function(e){const[t,n]=oe(this,vs,"m",Ds).call(this,e,oe(this,xs,"f"));re(this,xs,t),oe(this,Ss,"f")[t.id]=t;for(const s of n){const e=t.content[s.index];"text"==(null==e?void 0:e.type)&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,s=t.content[n.index];if(!s||"text"!=s.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,s.text)}if(n.index!=oe(this,As,"f")){if(oe(this,$s,"f"))switch(oe(this,$s,"f").type){case"text":this._emit("textDone",oe(this,$s,"f").text,oe(this,xs,"f"));break;case"image_file":this._emit("imageFileDone",oe(this,$s,"f").image_file,oe(this,xs,"f"))}re(this,As,n.index)}re(this,$s,t.content[n.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==oe(this,As,"f")){const t=e.data.content[oe(this,As,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,oe(this,xs,"f"));break;case"text":this._emit("textDone",t.text,oe(this,xs,"f"))}}oe(this,xs,"f")&&this._emit("messageDone",e.data),re(this,xs,void 0)}},Cs=function(e){const t=oe(this,vs,"m",Ms).call(this,e);switch(re(this,Ls,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==oe(this,Is,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(oe(this,Rs,"f")&&this._emit("toolCallDone",oe(this,Rs,"f")),re(this,Is,e.index),re(this,Rs,t.step_details.tool_calls[e.index]),oe(this,Rs,"f")&&this._emit("toolCallCreated",oe(this,Rs,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":re(this,Ls,void 0);"tool_calls"==e.data.step_details.type&&oe(this,Rs,"f")&&(this._emit("toolCallDone",oe(this,Rs,"f")),re(this,Rs,void 0)),this._emit("runStepDone",e.data,t)}},Ns=function(e){oe(this,bs,"f").push(e),this._emit("event",e)},Ms=function(e){switch(e.event){case"thread.run.step.created":return oe(this,ws,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=oe(this,ws,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=_s.accumulateDelta(t,n.delta);oe(this,ws,"f")[e.data.id]=s}return oe(this,ws,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":oe(this,ws,"f")[e.data.id]=e.data}if(oe(this,ws,"f")[e.data.id])return oe(this,ws,"f")[e.data.id];throw new Error("No snapshot available")},Ds=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const e of s.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=oe(this,vs,"m",Bs).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Bs=function(e,t){return _s.accumulateDelta(t,e)},qs=function(e){switch(re(this,Es,e.data),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":re(this,Os,e.data),oe(this,Rs,"f")&&(this._emit("toolCallDone",oe(this,Rs,"f")),re(this,Rs,void 0))}};let Us=class extends Dt{constructor(){super(...arguments),this.steps=new ms(this._client)}create(e,t,n){var s;const r=t,{include:o}=r,i=h(r,["include"]);return this._client.post(Wt`/threads/${e}/runs`,d(u({query:{include:o},body:i},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers]),stream:null!=(s=t.stream)&&s}))}retrieve(e,t,n){const{thread_id:s}=t;return this._client.get(Wt`/threads/${s}/runs/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}update(e,t,n){const s=t,{thread_id:r}=s,o=h(s,["thread_id"]);return this._client.post(Wt`/threads/${r}/runs/${e}`,d(u({body:o},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e,t={},n){return this._client.getAPIList(Wt`/threads/${e}/runs`,It,d(u({query:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}cancel(e,t,n){const{thread_id:s}=t;return this._client.post(Wt`/threads/${s}/runs/${e}/cancel`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}createAndPoll(e,t,n){return f(this,null,function*(){const s=yield this.create(e,t,n);return yield this.poll(s.id,{thread_id:e},n)})}createAndStream(e,t,n){return Ws.createAssistantStream(e,this._client.beta.threads.runs,t,n)}poll(e,t,n){return f(this,null,function*(){var s,r;const o=rs([null==n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!=(r=null==(s=null==n?void 0:n.pollIntervalMs)?void 0:s.toString())?r:void 0}]);for(;;){const{data:s,response:r}=yield this.retrieve(e,t,d(u({},n),{headers:u(u({},null==n?void 0:n.headers),o)})).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}yield ke(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}})}stream(e,t,n){return Ws.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){var s;const r=t,{thread_id:o}=r,i=h(r,["thread_id"]);return this._client.post(Wt`/threads/${o}/runs/${e}/submit_tool_outputs`,d(u({body:i},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers]),stream:null!=(s=t.stream)&&s}))}submitToolOutputsAndPoll(e,t,n){return f(this,null,function*(){const s=yield this.submitToolOutputs(e,t,n);return yield this.poll(s.id,t,n)})}submitToolOutputsStream(e,t,n){return Ws.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Us.Steps=ms;class Fs extends Dt{constructor(){super(...arguments),this.runs=new Us(this._client),this.messages=new ps(this._client)}create(e={},t){return this._client.post("/threads",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}retrieve(e,t){return this._client.get(Wt`/threads/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}update(e,t,n){return this._client.post(Wt`/threads/${e}`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}delete(e,t){return this._client.delete(Wt`/threads/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}createAndRun(e,t){var n;return this._client.post("/threads/runs",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers]),stream:null!=(n=e.stream)&&n}))}createAndRunPoll(e,t){return f(this,null,function*(){const n=yield this.createAndRun(e,t);return yield this.runs.poll(n.id,{thread_id:n.thread_id},t)})}createAndRunStream(e,t){return Ws.createThreadAssistantStream(e,this._client.beta.threads,t)}}Fs.Runs=Us,Fs.Messages=ps;class Hs extends Dt{constructor(){super(...arguments),this.realtime=new fs(this._client),this.assistants=new us(this._client),this.threads=new Fs(this._client)}}Hs.Realtime=fs,Hs.Assistants=us,Hs.Threads=Fs;class Xs extends Dt{create(e,t){var n;return this._client.post("/completions",d(u({body:e},t),{stream:null!=(n=e.stream)&&n}))}}class Ks extends Dt{retrieve(e,t,n){const{container_id:s}=t;return this._client.get(Wt`/containers/${s}/files/${e}/content`,d(u({},n),{headers:rs([{Accept:"application/binary"},null==n?void 0:n.headers]),__binaryResponse:!0}))}}let Js=class extends Dt{constructor(){super(...arguments),this.content=new Ks(this._client)}create(e,t,n){return this._client.post(Wt`/containers/${e}/files`,Pt(u({body:t},n),this._client))}retrieve(e,t,n){const{container_id:s}=t;return this._client.get(Wt`/containers/${s}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(Wt`/containers/${e}/files`,It,u({query:t},n))}delete(e,t,n){const{container_id:s}=t;return this._client.delete(Wt`/containers/${s}/files/${e}`,d(u({},n),{headers:rs([{Accept:"*/*"},null==n?void 0:n.headers])}))}};Js.Content=Ks;class zs extends Dt{constructor(){super(...arguments),this.files=new Js(this._client)}create(e,t){return this._client.post("/containers",u({body:e},t))}retrieve(e,t){return this._client.get(Wt`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",It,u({query:e},t))}delete(e,t){return this._client.delete(Wt`/containers/${e}`,d(u({},t),{headers:rs([{Accept:"*/*"},null==t?void 0:t.headers])}))}}zs.Files=Js;class Vs extends Dt{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&pt(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",u({body:d(u({},e),{encoding_format:s})},t));return n?r:(pt(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.charCodeAt(e);return Array.from(new Float32Array(s.buffer))}})(t)}),e)))}}class Gs extends Dt{retrieve(e,t,n){const{eval_id:s,run_id:r}=t;return this._client.get(Wt`/evals/${s}/runs/${r}/output_items/${e}`,n)}list(e,t,n){const s=t,{eval_id:r}=s,o=h(s,["eval_id"]);return this._client.getAPIList(Wt`/evals/${r}/runs/${e}/output_items`,It,u({query:o},n))}}class Ys extends Dt{constructor(){super(...arguments),this.outputItems=new Gs(this._client)}create(e,t,n){return this._client.post(Wt`/evals/${e}/runs`,u({body:t},n))}retrieve(e,t,n){const{eval_id:s}=t;return this._client.get(Wt`/evals/${s}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(Wt`/evals/${e}/runs`,It,u({query:t},n))}delete(e,t,n){const{eval_id:s}=t;return this._client.delete(Wt`/evals/${s}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:s}=t;return this._client.post(Wt`/evals/${s}/runs/${e}`,n)}}Ys.OutputItems=Gs;class Qs extends Dt{constructor(){super(...arguments),this.runs=new Ys(this._client)}create(e,t){return this._client.post("/evals",u({body:e},t))}retrieve(e,t){return this._client.get(Wt`/evals/${e}`,t)}update(e,t,n){return this._client.post(Wt`/evals/${e}`,u({body:t},n))}list(e={},t){return this._client.getAPIList("/evals",It,u({query:e},t))}delete(e,t){return this._client.delete(Wt`/evals/${e}`,t)}}Qs.Runs=Ys;let Zs=class extends Dt{create(e,t){return this._client.post("/files",Pt(u({body:e},t),this._client))}retrieve(e,t){return this._client.get(Wt`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",It,u({query:e},t))}delete(e,t){return this._client.delete(Wt`/files/${e}`,t)}content(e,t){return this._client.get(Wt`/files/${e}/content`,d(u({},t),{headers:rs([{Accept:"application/binary"},null==t?void 0:t.headers]),__binaryResponse:!0}))}waitForProcessing(e){return f(this,arguments,function*(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const s=new Set(["processed","error","deleted"]),r=Date.now();let o=yield this.retrieve(e);for(;!o.status||!s.has(o.status);)if(yield ke(t),o=yield this.retrieve(e),Date.now()-r>n)throw new fe({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o})}};class er extends Dt{}let tr=class extends Dt{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",u({body:e},t))}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",u({body:e},t))}};class nr extends Dt{constructor(){super(...arguments),this.graders=new tr(this._client)}}nr.Graders=tr;class sr extends Dt{create(e,t,n){return this._client.getAPIList(Wt`/fine_tuning/checkpoints/${e}/permissions`,$t,u({body:t,method:"post"},n))}retrieve(e,t={},n){return this._client.get(Wt`/fine_tuning/checkpoints/${e}/permissions`,u({query:t},n))}delete(e,t,n){const{fine_tuned_model_checkpoint:s}=t;return this._client.delete(Wt`/fine_tuning/checkpoints/${s}/permissions/${e}`,n)}}let rr=class extends Dt{constructor(){super(...arguments),this.permissions=new sr(this._client)}};rr.Permissions=sr;class or extends Dt{list(e,t={},n){return this._client.getAPIList(Wt`/fine_tuning/jobs/${e}/checkpoints`,It,u({query:t},n))}}class ir extends Dt{constructor(){super(...arguments),this.checkpoints=new or(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",u({body:e},t))}retrieve(e,t){return this._client.get(Wt`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",It,u({query:e},t))}cancel(e,t){return this._client.post(Wt`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(Wt`/fine_tuning/jobs/${e}/events`,It,u({query:t},n))}pause(e,t){return this._client.post(Wt`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(Wt`/fine_tuning/jobs/${e}/resume`,t)}}ir.Checkpoints=or;class ar extends Dt{constructor(){super(...arguments),this.methods=new er(this._client),this.jobs=new ir(this._client),this.checkpoints=new rr(this._client),this.alpha=new nr(this._client)}}ar.Methods=er,ar.Jobs=ir,ar.Checkpoints=rr,ar.Alpha=nr;class lr extends Dt{}class cr extends Dt{constructor(){super(...arguments),this.graderModels=new lr(this._client)}}cr.GraderModels=lr;class ur extends Dt{createVariation(e,t){return this._client.post("/images/variations",Pt(u({body:e},t),this._client))}edit(e,t){var n;return this._client.post("/images/edits",Pt(d(u({body:e},t),{stream:null!=(n=e.stream)&&n}),this._client))}generate(e,t){var n;return this._client.post("/images/generations",d(u({body:e},t),{stream:null!=(n=e.stream)&&n}))}}class dr extends Dt{retrieve(e,t){return this._client.get(Wt`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",$t,e)}delete(e,t){return this._client.delete(Wt`/models/${e}`,t)}}class hr extends Dt{create(e,t){return this._client.post("/moderations",u({body:e},t))}}function fr(e,t){return t&&function(e){var t;if(mn(null==(t=e.text)?void 0:t.format))return!0;return!1}(t)?pr(e,t):d(u({},e),{output_parsed:null,output:e.output.map(e=>"function_call"===e.type?d(u({},e),{parsed_arguments:null}):"message"===e.type?d(u({},e),{content:e.content.map(e=>d(u({},e),{parsed:null}))}):e)})}function pr(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return d(u({},e),{parsed_arguments:yr(t,e)});if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?d(u({},e),{parsed:mr(t,e.text)}):e);return d(u({},e),{content:n})}return e}),s=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||gr(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const e of s.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),s}function mr(e,t){var n,s,r,o;if("json_schema"!==(null==(s=null==(n=e.text)?void 0:n.format)?void 0:s.type))return null;if("$parseRaw"in(null==(r=e.text)?void 0:r.format)){return(null==(o=e.text)?void 0:o.format).$parseRaw(t)}return JSON.parse(t)}function yr(e,t){var n;const s=(r=null!=(n=e.tools)?n:[],o=t.name,r.find(e=>"function"===e.type&&e.name===o));var r,o,i;return d(u(u({},t),t),{parsed_arguments:(i=s,"auto-parseable-tool"===(null==i?void 0:i.$brand)?s.$parseRaw(t.arguments):(null==s?void 0:s.strict)?JSON.parse(t.arguments):null)})}function gr(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}var vr,_r,br,wr,Sr,xr,Or,Ar;class $r extends pn{constructor(e){super(),vr.add(this),_r.set(this,void 0),br.set(this,void 0),wr.set(this,void 0),re(this,_r,e)}static createResponse(e,t,n){const s=new $r(t);return s._run(()=>s._createOrRetrieveResponse(e,t,d(u({},n),{headers:d(u({},null==n?void 0:n.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}_createOrRetrieveResponse(e,t,n){return f(this,null,function*(){var s,r;const o=null==n?void 0:n.signal;let i;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),oe(this,vr,"m",Sr).call(this);let a=null;"response_id"in t?(i=yield e.responses.retrieve(t.response_id,{stream:!0},d(u({},n),{signal:this.controller.signal,stream:!0})),a=null!=(s=t.starting_after)?s:null):i=yield e.responses.create(d(u({},t),{stream:!0}),d(u({},n),{signal:this.controller.signal})),this._connected();try{for(var l,c,h,f=g(i);l=!(c=yield f.next()).done;l=!1){const e=c.value;oe(this,vr,"m",xr).call(this,e,a)}}catch(c){h=[c]}finally{try{l&&(c=f.return)&&(yield c.call(f))}finally{if(h)throw h[0]}}if(null==(r=i.controller.signal)?void 0:r.aborted)throw new de;return oe(this,vr,"m",Or).call(this)})}[(_r=new WeakMap,br=new WeakMap,wr=new WeakMap,vr=new WeakSet,Sr=function(){this.ended||re(this,br,void 0)},xr=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},s=oe(this,vr,"m",Ar).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=s.output[e.output_index];if(!t)throw new ce(`missing output at index ${e.output_index}`);if("message"===t.type){const s=t.content[e.content_index];if(!s)throw new ce(`missing content at index ${e.content_index}`);if("output_text"!==s.type)throw new ce(`expected content to be 'output_text', got ${s.type}`);n("response.output_text.delta",d(u({},e),{snapshot:s.text}))}break}case"response.function_call_arguments.delta":{const t=s.output[e.output_index];if(!t)throw new ce(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",d(u({},e),{snapshot:t.arguments}));break}default:n(e.type,e)}},Or=function(){if(this.ended)throw new ce("stream has ended, this shouldn't happen");const e=oe(this,br,"f");if(!e)throw new ce("request ended without sending any events");re(this,br,void 0);const t=function(e,t){return fr(e,t)}(e,oe(this,_r,"f"));return re(this,wr,t),t},Ar=function(e){let t=oe(this,br,"f");if(!t){if("response.created"!==e.type)throw new ce(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=re(this,br,e.response),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new ce(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new ce(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new ce(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new ce(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new ce(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":re(this,br,e.response)}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const s=t.shift();s?s.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:()=>f(this,null,function*(){if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}finalResponse(){return f(this,null,function*(){yield this.done();const e=oe(this,wr,"f");if(!e)throw new ce("stream ended without producing a ChatCompletion");return e})}}class Ir extends Dt{list(e,t={},n){return this._client.getAPIList(Wt`/responses/${e}/input_items`,It,u({query:t},n))}}class Rr extends Dt{constructor(){super(...arguments),this.inputItems=new Ir(this._client)}create(e,t){var n;return this._client.post("/responses",d(u({body:e},t),{stream:null!=(n=e.stream)&&n}))._thenUnwrap(e=>("object"in e&&"response"===e.object&&gr(e),e))}retrieve(e,t={},n){var s;return this._client.get(Wt`/responses/${e}`,d(u({query:t},n),{stream:null!=(s=null==t?void 0:t.stream)&&s}))._thenUnwrap(e=>("object"in e&&"response"===e.object&&gr(e),e))}delete(e,t){return this._client.delete(Wt`/responses/${e}`,d(u({},t),{headers:rs([{Accept:"*/*"},null==t?void 0:t.headers])}))}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>pr(t,e))}stream(e,t){return $r.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(Wt`/responses/${e}/cancel`,t)}}Rr.InputItems=Ir;class kr extends Dt{create(e,t,n){return this._client.post(Wt`/uploads/${e}/parts`,Pt(u({body:t},n),this._client))}}class Er extends Dt{constructor(){super(...arguments),this.parts=new kr(this._client)}create(e,t){return this._client.post("/uploads",u({body:e},t))}cancel(e,t){return this._client.post(Wt`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(Wt`/uploads/${e}/complete`,u({body:t},n))}}Er.Parts=kr;class Lr extends Dt{create(e,t,n){return this._client.post(Wt`/vector_stores/${e}/file_batches`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}retrieve(e,t,n){const{vector_store_id:s}=t;return this._client.get(Wt`/vector_stores/${s}/file_batches/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}cancel(e,t,n){const{vector_store_id:s}=t;return this._client.post(Wt`/vector_stores/${s}/file_batches/${e}/cancel`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}createAndPoll(e,t,n){return f(this,null,function*(){const s=yield this.create(e,t);return yield this.poll(e,s.id,n)})}listFiles(e,t,n){const s=t,{vector_store_id:r}=s,o=h(s,["vector_store_id"]);return this._client.getAPIList(Wt`/vector_stores/${r}/file_batches/${e}/files`,It,d(u({query:o},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}poll(e,t,n){return f(this,null,function*(){var s,r;const o=rs([null==n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!=(r=null==(s=null==n?void 0:n.pollIntervalMs)?void 0:s.toString())?r:void 0}]);for(;;){const{data:s,response:r}=yield this.retrieve(t,{vector_store_id:e},d(u({},n),{headers:o})).withResponse();switch(s.status){case"in_progress":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}yield ke(e);break;case"failed":case"cancelled":case"completed":return s}}})}uploadAndPoll(e,t,n){return f(this,arguments,function*(e,{files:t,fileIds:n=[]},s){var r;if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=null!=(r=null==s?void 0:s.maxConcurrency)?r:5,i=Math.min(o,t.length),a=this._client,l=t.values(),c=[...n];const u=Array(i).fill(l).map(function(e){return f(this,null,function*(){for(let t of e){const e=yield a.files.create({file:t,purpose:"assistants"},s);c.push(e.id)}})});var d;return yield(d=u,f(void 0,null,function*(){const e=yield Promise.allSettled(d),t=e.filter(e=>"rejected"===e.status);if(t.length){for(const e of t);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)"fulfilled"===s.status&&n.push(s.value);return n})),yield this.createAndPoll(e,{file_ids:c})})}}class Pr extends Dt{create(e,t,n){return this._client.post(Wt`/vector_stores/${e}/files`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}retrieve(e,t,n){const{vector_store_id:s}=t;return this._client.get(Wt`/vector_stores/${s}/files/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}update(e,t,n){const s=t,{vector_store_id:r}=s,o=h(s,["vector_store_id"]);return this._client.post(Wt`/vector_stores/${r}/files/${e}`,d(u({body:o},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e,t={},n){return this._client.getAPIList(Wt`/vector_stores/${e}/files`,It,d(u({query:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}delete(e,t,n){const{vector_store_id:s}=t;return this._client.delete(Wt`/vector_stores/${s}/files/${e}`,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}createAndPoll(e,t,n){return f(this,null,function*(){const s=yield this.create(e,t,n);return yield this.poll(e,s.id,n)})}poll(e,t,n){return f(this,null,function*(){var s,r;const o=rs([null==n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!=(r=null==(s=null==n?void 0:n.pollIntervalMs)?void 0:s.toString())?r:void 0}]);for(;;){const s=yield this.retrieve(t,{vector_store_id:e},d(u({},n),{headers:o})).withResponse(),r=s.data;switch(r.status){case"in_progress":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}yield ke(e);break;case"failed":case"completed":return r}}})}upload(e,t,n){return f(this,null,function*(){const s=yield this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)})}uploadAndPoll(e,t,n){return f(this,null,function*(){const s=yield this.upload(e,t,n);return yield this.poll(e,s.id,n)})}content(e,t,n){const{vector_store_id:s}=t;return this._client.getAPIList(Wt`/vector_stores/${s}/files/${e}/content`,$t,d(u({},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}}class Tr extends Dt{constructor(){super(...arguments),this.files=new Pr(this._client),this.fileBatches=new Lr(this._client)}create(e,t){return this._client.post("/vector_stores",d(u({body:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}retrieve(e,t){return this._client.get(Wt`/vector_stores/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}update(e,t,n){return this._client.post(Wt`/vector_stores/${e}`,d(u({body:t},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}list(e={},t){return this._client.getAPIList("/vector_stores",It,d(u({query:e},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}delete(e,t){return this._client.delete(Wt`/vector_stores/${e}`,d(u({},t),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])}))}search(e,t,n){return this._client.getAPIList(Wt`/vector_stores/${e}/search`,$t,d(u({body:t,method:"post"},n),{headers:rs([{"OpenAI-Beta":"assistants=v2"},null==n?void 0:n.headers])}))}}var jr,Cr,Nr,Mr,Dr,Br,qr;Tr.Files=Pr,Tr.FileBatches=Lr;class Wr extends Dt{constructor(){super(...arguments),jr.add(this)}unwrap(e,t){return f(this,arguments,function*(e,t,n=this._client.webhookSecret,s=300){return yield this.verifySignature(e,t,n,s),JSON.parse(e)})}verifySignature(e,t){return f(this,arguments,function*(e,t,n=this._client.webhookSecret,s=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");oe(this,jr,"m",Cr).call(this,n);const r=rs([t]).values,o=oe(this,jr,"m",Nr).call(this,r,"webhook-signature"),i=oe(this,jr,"m",Nr).call(this,r,"webhook-timestamp"),a=oe(this,jr,"m",Nr).call(this,r,"webhook-id"),l=parseInt(i,10);if(isNaN(l))throw new Oe("Invalid webhook timestamp format");const c=Math.floor(Date.now()/1e3);if(c-l>s)throw new Oe("Webhook timestamp is too old");if(l>c+s)throw new Oe("Webhook timestamp is too new");const u=o.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=a?`${a}.${i}.${e}`:`${i}.${e}`,f=yield crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const m of u)try{const e=Buffer.from(m,"base64");if(yield crypto.subtle.verify("HMAC",f,e,(new TextEncoder).encode(h)))return}catch(p){continue}throw new Oe("The given webhook signature does not match the expected signature")})}}jr=new WeakSet,Cr=function(e){if("string"!=typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Nr=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null==n)throw new Error(`Missing required header: ${t}`);return n};class Ur{constructor(e={}){var t,n,s,r,o,i,a=e,{baseURL:l=gs("OPENAI_BASE_URL"),apiKey:c=gs("OPENAI_API_KEY"),organization:f=(e=>null!=(e=gs("OPENAI_ORG_ID"))?e:null)(),project:p=(e=>null!=(e=gs("OPENAI_PROJECT_ID"))?e:null)(),webhookSecret:m=(e=>null!=(e=gs("OPENAI_WEBHOOK_SECRET"))?e:null)()}=a,y=h(a,["baseURL","apiKey","organization","project","webhookSecret"]);if(Mr.add(this),Br.set(this,void 0),this.completions=new Xs(this),this.chat=new ts(this),this.embeddings=new Vs(this),this.files=new Zs(this),this.images=new ur(this),this.audio=new ls(this),this.moderations=new hr(this),this.models=new dr(this),this.fineTuning=new ar(this),this.graders=new cr(this),this.vectorStores=new Tr(this),this.webhooks=new Wr(this),this.beta=new Hs(this),this.batches=new cs(this),this.uploads=new Er(this),this.responses=new Rr(this),this.evals=new Qs(this),this.containers=new zs(this),void 0===c)throw new ce("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const g=d(u({apiKey:c,organization:f,project:p,webhookSecret:m},y),{baseURL:l||"https://api.openai.com/v1"});if(!g.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new ce("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=g.baseURL,this.timeout=null!=(t=g.timeout)?t:Dr.DEFAULT_TIMEOUT,this.logger=null!=(n=g.logger)?n:console;const v="warn";this.logLevel=v,this.logLevel=null!=(r=null!=(s=ct(g.logLevel,"ClientOptions.logLevel",this))?s:ct(gs("OPENAI_LOG"),"process.env['OPENAI_LOG']",this))?r:v,this.fetchOptions=g.fetchOptions,this.maxRetries=null!=(o=g.maxRetries)?o:2,this.fetch=null!=(i=g.fetch)?i:function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),re(this,Br,De),this._options=g,this.apiKey=c,this.organization=f,this.project=p,this.webhookSecret=m}withOptions(e){return new this.constructor(u(d(u({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret}),e))}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return f(this,null,function*(){return rs([{Authorization:`Bearer ${this.apiKey}`}])})}stringifyQuery(e){return Qe(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ee}`}defaultIdempotencyKey(){return`stainless-node-retry-${ie()}`}makeStatusError(e,t,n,s){return ue.generate(e,t,n,s)}buildURL(e,t,n){const s=!oe(this,Mr,"m",qr).call(this)&&n||this.baseURL,r=(e=>Ae.test(e))(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(o)||(t=u(u({},o),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}prepareOptions(e){return f(this,null,function*(){})}prepareRequest(e,t){return f(this,arguments,function*(e,{url:t,options:n}){})}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>u({method:e,path:t},n)))}request(e,t=null){return new xt(this,this.makeRequest(e,t,void 0))}makeRequest(e,t,n){return f(this,null,function*(){var s,r,o;const i=yield e,a=null!=(s=i.maxRetries)?s:this.maxRetries;null==t&&(t=a),yield this.prepareOptions(i);const{req:l,url:c,timeout:u}=yield this.buildRequest(i,{retryCount:a-t});yield this.prepareRequest(l,{url:c,options:i});const d="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),h=void 0===n?"":`, retryOf: ${n}`,p=Date.now();if(pt(this).debug(`[${d}] sending request`,mt({retryOfRequestLogID:n,method:i.method,url:c,options:i,headers:l.headers})),null==(r=i.signal)?void 0:r.aborted)throw new de;const m=new AbortController,y=yield this.fetchWithTimeout(c,l,u,m).catch(le),g=Date.now();if(y instanceof Error){const e=`retrying, ${t} attempts remaining`;if(null==(o=i.signal)?void 0:o.aborted)throw new de;const s=ae(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return pt(this).info(`[${d}] connection ${s?"timed out":"failed"} - ${e}`),pt(this).debug(`[${d}] connection ${s?"timed out":"failed"} (${e})`,mt({retryOfRequestLogID:n,url:c,durationMs:g-p,message:y.message})),this.retryRequest(i,t,null!=n?n:d);if(pt(this).info(`[${d}] connection ${s?"timed out":"failed"} - error; no more retries left`),pt(this).debug(`[${d}] connection ${s?"timed out":"failed"} (error; no more retries left)`,mt({retryOfRequestLogID:n,url:c,durationMs:g-p,message:y.message})),s)throw new fe;throw new he({cause:y})}const v=`[${d}${h}${[...y.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join("")}] ${l.method} ${c} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${g-p}ms`;if(!y.ok){const e=yield this.shouldRetry(y);if(t&&e){const e=`retrying, ${t} attempts remaining`;return yield function(e){return f(this,null,function*(){var t,n;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(yield null==(n=(t=e[Symbol.asyncIterator]()).return)?void 0:n.call(t));const s=e.getReader(),r=s.cancel();s.releaseLock(),yield r})}(y.body),pt(this).info(`${v} - ${e}`),pt(this).debug(`[${d}] response error (${e})`,mt({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:g-p})),this.retryRequest(i,t,null!=n?n:d,y.headers)}const s=e?"error; no more retries left":"error; not retryable";pt(this).info(`${v} - ${s}`);const r=yield y.text().catch(e=>le(e).message),o=(e=>{try{return JSON.parse(e)}catch(t){return}})(r),a=o?void 0:r;pt(this).debug(`[${d}] response error (${s})`,mt({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,message:a,durationMs:Date.now()-p}));throw this.makeStatusError(y.status,o,a,y.headers)}return pt(this).info(v),pt(this).debug(`[${d}] response start`,mt({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:g-p})),{response:y,options:i,controller:m,requestLogID:d,retryOfRequestLogID:n,startTime:p}})}getAPIList(e,t,n){return this.requestAPIList(t,u({method:"get",path:e},n))}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new At(this,n,e)}fetchWithTimeout(e,t,n,s){return f(this,null,function*(){const r=t||{},{signal:o,method:i}=r,a=h(r,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),n),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,f=u(d(u({signal:s.signal},c?{duplex:"half"}:{}),{method:"GET"}),a);i&&(f.method=i.toUpperCase());try{return yield this.fetch.call(void 0,e,f)}finally{clearTimeout(l)}})}shouldRetry(e){return f(this,null,function*(){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))})}retryRequest(e,t,n,s){return f(this,null,function*(){var r;let o;const i=null==s?void 0:s.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(o=e)}const a=null==s?void 0:s.get("retry-after");if(a&&!o){const e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){const n=null!=(r=e.maxRetries)?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,n)}return yield ke(o),this.makeRequest(e,t-1,n)})}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}buildRequest(e){return f(this,arguments,function*(e,{retryCount:t=0}={}){var n,s,r;const o=u({},e),{method:i,path:a,query:l,defaultBaseURL:c}=o,d=this.buildURL(a,l,c);"timeout"in o&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ce(`${e} must be an integer`);if(t<0)throw new ce(`${e} must be a positive integer`)})("timeout",o.timeout),o.timeout=null!=(n=o.timeout)?n:this.timeout;const{bodyHeaders:h,body:f}=this.buildBody({options:o}),p=yield this.buildHeaders({options:e,method:i,bodyHeaders:h,retryCount:t});return{req:u(u(u(u(u({method:i,headers:p},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"}),f&&{body:f}),null!=(s=this.fetchOptions)?s:{}),null!=(r=o.fetchOptions)?r:{}),url:d,timeout:o.timeout}})}buildHeaders(e){return f(this,arguments,function*({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=rs([r,d(u(u({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),null!=je?je:je=Le()),{"OpenAI-Organization":this.organization,"OpenAI-Project":this.project}),yield this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(o),o.values})}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=rs([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:Ne(e)}:oe(this,Br,"f").call(this,{body:e,headers:n})}}Dr=Ur,Br=new WeakMap,Mr=new WeakSet,qr=function(){return"https://api.openai.com/v1"!==this.baseURL},Ur.OpenAI=Dr,Ur.DEFAULT_TIMEOUT=6e5,Ur.OpenAIError=ce,Ur.APIError=ue,Ur.APIConnectionError=he,Ur.APIConnectionTimeoutError=fe,Ur.APIUserAbortError=de,Ur.NotFoundError=ge,Ur.ConflictError=ve,Ur.RateLimitError=be,Ur.BadRequestError=pe,Ur.AuthenticationError=me,Ur.InternalServerError=we,Ur.PermissionDeniedError=ye,Ur.UnprocessableEntityError=_e,Ur.InvalidWebhookSignatureError=Oe,Ur.toFile=function(e,t,n){return f(this,null,function*(){if(Rt(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Nt(e))(e=yield e))return e instanceof File?e:kt([yield e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const s=yield e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),kt(yield Mt(s),t,n)}const s=yield Mt(e);if(t||(t=Et(e)),!(null==n?void 0:n.type)){const e=s.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n=d(u({},n),{type:e}))}return kt(s,t,n)})},Ur.Completions=Xs,Ur.Chat=ts,Ur.Embeddings=Vs,Ur.Files=Zs,Ur.Images=ur,Ur.Audio=ls,Ur.Moderations=hr,Ur.Models=dr,Ur.FineTuning=ar,Ur.Graders=cr,Ur.VectorStores=Tr,Ur.Webhooks=Wr,Ur.Beta=Hs,Ur.Batches=cs,Ur.Uploads=Er,Ur.Responses=Rr,Ur.Evals=Qs,Ur.Containers=zs;export{Ur as O,se as s};

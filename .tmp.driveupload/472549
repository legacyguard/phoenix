var e=(e,s,i)=>new Promise((n,t)=>{var r=e=>{try{c(i.next(e))}catch(s){t(s)}},a=e=>{try{c(i.throw(e))}catch(s){t(s)}},c=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,a);c((i=i.apply(e,s)).next())});import{j as s}from"./vendor-ui-DOX-GngI.js";import{j as i,u as n,r as t}from"./vendor-react-BsuoGMue.js";import{N as r,S as a,C as c,e as l,a as o,b as d,d as u,B as m,h as p,j as v,t as x,s as h}from"./index-Co25CVR3.js";import{u as j}from"./vendor-i18n-C5HfoztV.js";import{C as f}from"./circle-x-CEnMZa5N.js";import{U as g}from"./user-EybOgkzK.js";import"./vendor-auth-CQQWOfx5.js";import"./vendor-supabase-DjxWZ-e5.js";import"./vendor-utils-DZ4dNBww.js";const N=()=>{const{inviteToken:N}=i(),w=n(),{t:b}=j("common"),[y,A]=t.useState(null),[S,k]=t.useState(!0),[R,T]=t.useState(!1),[F,D]=t.useState("");t.useEffect(()=>{let s=!0;const i=new AbortController;return e(void 0,null,function*(){var e,i,n;if(N)try{const{data:e,error:i}=yield h.from("guardians").select("*").eq("invitation_token",N).single();if(!s)return;if(i||!e)return x.error(b("inviteAcceptance.errors.notFound")),void w("/");if("sent"!==e.invitation_status)return x.error(b("inviteAcceptance.errors.alreadyProcessed")),void w("/");A(e),D(b("inviteAcceptance.defaultInviterName"))}catch(t){if(!s)return;(new Date).toISOString(),(null==t?void 0:t.message)||b("errors.unknown"),null==t||t.code;let r=b("inviteAcceptance.errors.loadingFailed");"PGRST116"===(null==t?void 0:t.code)?r=b("errors.dataNotFound"):(null==(e=null==t?void 0:t.message)?void 0:e.includes("network"))?r=b("errors.networkError"):(null==(i=null==t?void 0:t.message)?void 0:i.includes("permission"))?r=b("errors.permissionDenied"):(null==(n=null==t?void 0:t.message)?void 0:n.includes("duplicate"))&&(r=b("errors.duplicateRecord")),x.error(r)}finally{s&&k(!1)}else s&&(x.error(b("inviteAcceptance.errors.invalidLink")),w("/"))}),()=>{s=!1,i.abort()}},[N,w,b]);return S?s.jsx(r,{children:s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx(a,{className:"h-8 w-8 text-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:b("inviteAcceptance.loading")})]})})}):y?s.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background to-muted/20",children:s.jsxs(c,{className:"w-full max-w-2xl",children:[s.jsxs(o,{className:"text-center pb-6",children:[s.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mx-auto mb-4",children:s.jsx(a,{className:"h-8 w-8 text-primary"})}),s.jsx(d,{className:"text-2xl mb-2",children:b("invite.title",{name:F})}),s.jsx(u,{className:"text-base",children:b("inviteAcceptance.subtitle")})]}),s.jsxs(l,{className:"space-y-6",children:[s.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[s.jsxs("h3",{className:"font-semibold flex items-center",children:[s.jsx(g,{className:"h-4 w-4 mr-2"}),b("inviteAcceptance.guardianRole.title")]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:b("inviteAcceptance.guardianRole.yourName")})," ",y.full_name]}),s.jsxs("p",{children:[s.jsx("strong",{children:b("inviteAcceptance.guardianRole.relationship")})," ",y.relationship]}),s.jsxs("div",{children:[s.jsx("strong",{children:b("inviteAcceptance.guardianRole.responsibilities")}),s.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:y.roles.map((e,i)=>s.jsx(m,{variant:"heritage",className:"text-xs",children:e},i))})]})]})]}),s.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-primary mb-2",children:b("inviteAcceptance.whatThisMeans.title")}),s.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[s.jsxs("li",{children:["• ",b("inviteAcceptance.whatThisMeans.point1")]}),s.jsxs("li",{children:["• ",b("inviteAcceptance.whatThisMeans.point2")]}),s.jsxs("li",{children:["• ",b("inviteAcceptance.whatThisMeans.point3")]}),s.jsxs("li",{children:["• ",b("inviteAcceptance.whatThisMeans.point4")]})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[s.jsxs(p,{onClick:()=>e(void 0,null,function*(){var e,s,i;if(y){T(!0);try{const{error:e}=yield h.from("guardians").update({invitation_status:"accepted",accepted_at:(new Date).toISOString()}).eq("id",y.id);if(e)throw e;x.success(b("inviteAcceptance.messages.accepted")),w("/guardian-view")}catch(n){(new Date).toISOString(),(null==n?void 0:n.message)||b("errors.unknown"),null==n||n.code;let t=b("inviteAcceptance.errors.acceptFailed");"PGRST116"===(null==n?void 0:n.code)?t=b("errors.dataNotFound"):(null==(e=null==n?void 0:n.message)?void 0:e.includes("network"))?t=b("errors.networkError"):(null==(s=null==n?void 0:n.message)?void 0:s.includes("permission"))?t=b("errors.permissionDenied"):(null==(i=null==n?void 0:n.message)?void 0:i.includes("duplicate"))&&(t=b("errors.duplicateRecord")),x.error(t)}finally{T(!1)}}}),disabled:R,className:"flex-1",size:"lg",children:[s.jsx(v,{className:"h-4 w-4 mr-2"}),b(R?"inviteAcceptance.buttons.processing":"inviteAcceptance.buttons.acceptRole")]}),s.jsxs(p,{variant:"outline",onClick:()=>e(void 0,null,function*(){var e,s,i;if(y){T(!0);try{const{error:e}=yield h.from("guardians").update({invitation_status:"declined"}).eq("id",y.id);if(e)throw e;x.success(b("inviteAcceptance.messages.declined")),w("/")}catch(n){(new Date).toISOString(),(null==n?void 0:n.message)||b("errors.unknown"),null==n||n.code;let t=b("inviteAcceptance.errors.declineFailed");"PGRST116"===(null==n?void 0:n.code)?t=b("errors.dataNotFound"):(null==(e=null==n?void 0:n.message)?void 0:e.includes("network"))?t=b("errors.networkError"):(null==(s=null==n?void 0:n.message)?void 0:s.includes("permission"))?t=b("errors.permissionDenied"):(null==(i=null==n?void 0:n.message)?void 0:i.includes("duplicate"))&&(t=b("errors.duplicateRecord")),x.error(t)}finally{T(!1)}}}),disabled:R,className:"flex-1",size:"lg",children:[s.jsx(f,{className:"h-4 w-4 mr-2"}),b("inviteAcceptance.buttons.decline")]})]}),s.jsx("p",{className:"text-xs text-muted-foreground text-center",children:b("inviteAcceptance.disclaimer")})]})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx(c,{className:"w-full max-w-md",children:s.jsxs(l,{className:"text-center p-6",children:[s.jsx(f,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold mb-2",children:b("inviteAcceptance.notFound.title")}),s.jsx("p",{className:"text-muted-foreground",children:b("inviteAcceptance.notFound.description")})]})})})};export{N as InviteAcceptance};

var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,l=(t,e)=>{for(var r in e||(e={}))o.call(e,r)&&s(t,r,e[r]);if(n)for(var r of n(e))i.call(e,r)&&s(t,r,e[r]);return t},u=(t,e,r)=>s(t,"symbol"!=typeof e?e+"":e,r),a=(t,e,r)=>new Promise((n,o)=>{var i=t=>{try{l(r.next(t))}catch(e){o(e)}},s=t=>{try{l(r.throw(t))}catch(e){o(e)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(i,s);l((r=r.apply(t,e)).next())});import{s as p}from"./index-Co25CVR3.js";import"./vendor-react-BsuoGMue.js";const c={maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2};function d(t){return a(this,arguments,function*(t,e={}){var r;const n=l(l({},c),e);let o;for(let s=1;s<=n.maxAttempts;s++)try{if(null==(r=e.signal)?void 0:r.aborted)throw new Error("Operácia bola zrušená");return yield t()}catch(i){if(o=i,s===n.maxAttempts)throw i;if(n.retryCondition&&!n.retryCondition(i))throw i;n.onRetry&&n.onRetry(i,s);const t=Math.min(n.initialDelay*Math.pow(n.backoffMultiplier,s-1),n.maxDelay);yield y(t)}throw o})}function y(t){return new Promise(e=>setTimeout(e,t))}const f={networkErrors:t=>{var e,r;const n=(null==(e=null==t?void 0:t.message)?void 0:e.toLowerCase())||"",o=(null==(r=null==t?void 0:t.code)?void 0:r.toUpperCase())||"";return["network","fetch","ECONNREFUSED","ETIMEDOUT","ENOTFOUND","ECONNRESET","ECONNABORTED","EHOSTUNREACH","EPIPE","EAI_AGAIN"].some(t=>n.includes(t.toLowerCase())||o.includes(t.toUpperCase()))},httpRetryableErrors:t=>{var e;return[408,429,500,502,503,504].includes((null==t?void 0:t.status)||(null==(e=null==t?void 0:t.response)?void 0:e.status))},supabaseErrors:t=>["PGRST301","57P01","57P02","57P03","08001","08003","08006"].includes(null==t?void 0:t.code)||f.networkErrors(t)||f.httpRetryableErrors(t),default:t=>f.networkErrors(t)||f.httpRetryableErrors(t)};const h=new class{constructor(){u(this,"defaultRetryOptions",{maxAttempts:3,initialDelay:1e3,backoffMultiplier:2,retryCondition:f.supabaseErrors,onRetry:(t,e)=>{}}),u(this,"storage",{from:t=>{const e=p.storage.from(t);return{upload:(t,r,n)=>a(this,null,function*(){return d(()=>e.upload(t,r,n),this.defaultRetryOptions)}),download:t=>a(this,null,function*(){return d(()=>e.download(t),this.defaultRetryOptions)}),remove:t=>a(this,null,function*(){return d(()=>e.remove(t),this.defaultRetryOptions)}),createSignedUrl:(t,r)=>a(this,null,function*(){return d(()=>e.createSignedUrl(t,r),this.defaultRetryOptions)})}}}),u(this,"auth",{getUser:()=>a(this,null,function*(){return d(()=>p.auth.getUser(),this.defaultRetryOptions)}),signIn:t=>a(this,null,function*(){return d(()=>p.auth.signInWithPassword(t),(n=l({},this.defaultRetryOptions),e(n,r({maxAttempts:2}))));var n}),signOut:()=>a(this,null,function*(){return d(()=>p.auth.signOut(),this.defaultRetryOptions)})})}from(t){const e=p.from(t);return{select:(...t)=>this.wrapQuery(e.select(...t)),insert:(...t)=>this.wrapQuery(e.insert(...t)),update:(...t)=>this.wrapQuery(e.update(...t)),upsert:(...t)=>this.wrapQuery(e.upsert(...t)),delete:(...t)=>this.wrapQuery(e.delete(...t))}}wrapQuery(t){const e=()=>a(this,null,function*(){const e=yield t;if(e.error)throw e.error;return e});return new Proxy(t,{get:(t,r)=>["single","maybeSingle","csv","execute"].includes(r)?()=>a(this,null,function*(){return d(e,this.defaultRetryOptions)}):"function"==typeof t[r]?(...e)=>this.wrapQuery(t[r](...e)):t[r]})}retryOperation(t,e){return a(this,null,function*(){return d(t,l(l({},this.defaultRetryOptions),e))})}};export{h as s};
